<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é–¢æ•°ãƒ‡ãƒãƒƒã‚° - RentPipe</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .section { background: #f9f9f9; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .btn { background: #4285f4; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .result { background: white; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .error { background: #fee2e2; color: #991b1b; }
        .success { background: #d1fae5; color: #065f46; }
    </style>
</head>
<body>
    <h1>ğŸ” é–¢æ•°ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="section">
        <h3>ğŸ“Š ç¾åœ¨ã®é–¢æ•°çŠ¶æ³ç¢ºèª</h3>
        <button class="btn" onclick="checkCurrentFunctions()">é–¢æ•°çŠ¶æ³ç¢ºèª</button>
        <div id="function-status" class="result">é–¢æ•°ã®çŠ¶æ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>
    
    <div class="section">
        <h3>ğŸ”§ createGoogleFormé–¢æ•°ã®ä¸­èº«ç¢ºèª</h3>
        <button class="btn" onclick="checkFunctionContent()">é–¢æ•°å†…å®¹ç¢ºèª</button>
        <div id="function-content" class="result">é–¢æ•°ã®ä¸­èº«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>
    
    <div class="section">
        <h3>ğŸ“œ èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèª</h3>
        <button class="btn" onclick="checkLoadedScripts()">ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèª</button>
        <div id="loaded-scripts" class="result">èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>
    
    <div class="section">
        <h3>ğŸš€ Google Apps Scriptå°‚ç”¨é–¢æ•°ãƒ†ã‚¹ãƒˆ</h3>
        <input type="text" id="gas-url-debug" placeholder="Google Apps Script URL" style="width: 100%; padding: 8px; margin: 10px 0;">
        <button class="btn" onclick="testGASFunction()">GASå°‚ç”¨ãƒ†ã‚¹ãƒˆ</button>
        <div id="gas-test" class="result">ãƒ†ã‚¹ãƒˆçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>

    <!-- æœ€å°é™ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="js/create-test-customers.js"></script>
    <script src="js/google-apps-script-forms.js"></script>
    
    <!-- ç¾åœ¨ã®customer.htmlã¨åŒã˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§å•é¡Œã‚’å†ç¾ -->
    
    <script>
        // é–¢æ•°çŠ¶æ³ç¢ºèª
        function checkCurrentFunctions() {
            const functions = {
                'createGoogleForm': typeof window.createGoogleForm,
                'createGoogleFormGAS': typeof window.createGoogleFormGAS,
                'GoogleAppsScriptForms': typeof window.GoogleAppsScriptForms,
                'SimpleGoogleForms': typeof window.SimpleGoogleForms,
                'MinimalGoogleForms': typeof window.MinimalGoogleForms,
                'GoogleFormsAPIv2': typeof window.GoogleFormsAPIv2
            };
            
            let result = 'ğŸ“Š ç¾åœ¨ã®é–¢æ•°çŠ¶æ³:\n\n';
            for (const [name, type] of Object.entries(functions)) {
                result += `${name}: ${type}\n`;
            }
            
            // createGoogleFormé–¢æ•°ãŒã©ã“ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
            if (window.createGoogleForm) {
                result += '\nğŸ” createGoogleFormé–¢æ•°ã®å‡ºå…¸:\n';
                result += window.createGoogleForm.toString().substring(0, 200) + '...\n';
            }
            
            document.getElementById('function-status').textContent = result;
        }
        
        // é–¢æ•°å†…å®¹ç¢ºèª
        function checkFunctionContent() {
            let result = '';
            
            if (window.createGoogleForm) {
                result += 'ğŸ“ createGoogleForm é–¢æ•°ã®å®Œå…¨ãªå†…å®¹:\n\n';
                result += window.createGoogleForm.toString();
                
                // Google Apps Scripté–¢é€£ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                const gasKeywords = ['GoogleAppsScriptForms', 'script.google.com', 'gas'];
                const apiKeywords = ['gapi', 'forms.googleapis.com', 'SimpleGoogleForms'];
                
                result += '\n\nğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ†æ:\n';
                gasKeywords.forEach(keyword => {
                    if (window.createGoogleForm.toString().includes(keyword)) {
                        result += `âœ… Google Apps Scripté–¢é€£: ${keyword} ç™ºè¦‹\n`;
                    }
                });
                
                apiKeywords.forEach(keyword => {
                    if (window.createGoogleForm.toString().includes(keyword)) {
                        result += `âŒ å¤ã„APIé–¢é€£: ${keyword} ç™ºè¦‹\n`;
                    }
                });
            } else {
                result = 'âŒ createGoogleFormé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
            }
            
            document.getElementById('function-content').textContent = result;
        }
        
        // èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèª
        function checkLoadedScripts() {
            const scripts = Array.from(document.querySelectorAll('script'));
            let result = 'ğŸ“œ èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸€è¦§:\n\n';
            
            scripts.forEach((script, index) => {
                if (script.src) {
                    result += `${index + 1}. ${script.src}\n`;
                    
                    // å•é¡Œã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    if (script.src.includes('simple-google-forms') || 
                        script.src.includes('google-forms-api') ||
                        script.src.includes('minimal-google-forms')) {
                        result += '   âŒ å¤ã„APIã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆå•é¡Œã®åŸå› ï¼‰\n';
                    }
                    
                    if (script.src.includes('google-apps-script-forms')) {
                        result += '   âœ… Google Apps Scriptã‚¹ã‚¯ãƒªãƒ—ãƒˆ\n';
                    }
                } else if (script.textContent.length > 0) {
                    result += `${index + 1}. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (${script.textContent.length}æ–‡å­—)\n`;
                }
            });
            
            document.getElementById('loaded-scripts').textContent = result;
        }
        
        // Google Apps Scriptå°‚ç”¨ãƒ†ã‚¹ãƒˆ
        async function testGASFunction() {
            const gasUrl = document.getElementById('gas-url-debug').value.trim();
            const resultDiv = document.getElementById('gas-test');
            
            if (!gasUrl) {
                resultDiv.textContent = 'âŒ Google Apps Script URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                return;
            }
            
            try {
                resultDiv.textContent = 'ğŸ”„ Google Apps Scriptå°‚ç”¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
                
                // Google Apps Scriptè¨­å®š
                if (window.GoogleAppsScriptForms) {
                    window.GoogleAppsScriptForms.setScriptUrl(gasUrl);
                }
                
                const testCustomer = {
                    id: 'debug-test-' + Date.now(),
                    name: 'ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆå¤ªéƒ',
                    email: 'debug@example.com',
                    phone: '03-0000-0000'
                };
                
                // ç›´æ¥Google Apps ScriptçµŒç”±ã§ãƒ†ã‚¹ãƒˆ
                if (window.GoogleAppsScriptForms && window.GoogleAppsScriptForms.createCustomerForm) {
                    const result = await window.GoogleAppsScriptForms.createCustomerForm(testCustomer);
                    
                    if (result.success) {
                        resultDiv.className = 'result success';
                        resultDiv.textContent = `âœ… Google Apps Scriptå°‚ç”¨ãƒ†ã‚¹ãƒˆæˆåŠŸï¼

ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆå®Œäº†:
- ID: ${result.form.id}
- ã‚¿ã‚¤ãƒˆãƒ«: ${result.form.title}
- URL: ${result.form.url}

ğŸ‰ Google Apps Scriptã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼
å•é¡Œã¯ createGoogleForm é–¢æ•°ãŒå¤ã„APIã‚’å‘¼ã‚“ã§ã„ã‚‹ã“ã¨ã§ã™ã€‚`;
                        
                        if (confirm('ä½œæˆã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ ã‚’ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ')) {
                            window.open(result.form.url, '_blank');
                        }
                    } else {
                        throw new Error(result.error);
                    }
                } else {
                    throw new Error('GoogleAppsScriptFormsãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ Google Apps Scriptãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
            }
        }
        
        console.log('ğŸ” é–¢æ•°ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†');
    </script>
</body>
</html>
