<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>顧客管理 - RentPipe</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- ナビゲーション -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="index.html">
                    <span class="brand-icon">🏠</span>
                    <span class="brand-text">RentPipe</span>
                </a>
            </div>
            <div class="nav-menu" id="nav-menu">
                <a href="index.html" class="nav-link">ダッシュボード</a>
                <a href="customer.html" class="nav-link active">顧客管理</a>
                <a href="pipeline.html" class="nav-link">パイプライン</a>
                <a href="customer-form.html" class="nav-link">顧客フォーム</a>
            </div>
            <div class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <main class="main-content">
        <div class="content-header">
            <h1>顧客管理</h1>
            <p>顧客情報の一元管理・検索・更新</p>
        </div>

        <!-- 統計表示 -->
        <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-customers">0</div>
                <div class="stat-label">総顧客数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="active-customers">0</div>
                <div class="stat-label">アクティブ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completed-customers">0</div>
                <div class="stat-label">契約完了</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="conversion-rate">0%</div>
                <div class="stat-label">成約率</div>
            </div>
        </div>

        <!-- 操作パネル -->
        <div class="action-panel">
            <div class="search-section">
                <input type="text" id="search-input" placeholder="顧客名・メール・電話番号で検索" class="search-input">
                <select id="filter-select" class="filter-select">
                    <option value="all">全てのステータス</option>
                    <option value="初回相談">初回相談</option>
                    <option value="物件紹介">物件紹介</option>
                    <option value="内見">内見</option>
                    <option value="申込">申込</option>
                    <option value="審査">審査</option>
                    <option value="契約">契約</option>
                    <option value="完了">完了</option>
                </select>
                <select id="sort-select" class="sort-select">
                    <option value="createdAt-desc">登録日（新しい順）</option>
                    <option value="createdAt-asc">登録日（古い順）</option>
                    <option value="updatedAt-desc">更新日（新しい順）</option>
                    <option value="name-asc">名前（あいうえお順）</option>
                </select>
            </div>
            <div class="action-buttons">
                <button id="add-customer-btn" class="btn btn-primary">
                    <span>➕</span> 新規顧客追加
                </button>
                <button id="quick-add-btn" class="btn btn-secondary">
                    <span>⚡</span> クイック登録
                </button>
                <button id="export-csv-btn" class="btn btn-secondary" onclick="exportToCSV()">
                    <span>📊</span> CSV出力
                </button>
                <button id="export-json-btn" class="btn btn-secondary" onclick="exportToJSON()">
                    <span>💾</span> JSON出力
                </button>
            </div>
        </div>

        <!-- 顧客一覧テーブル -->
        <div class="table-container">
            <table class="customer-table" id="customer-table">
                <thead>
                    <tr>
                        <th>顧客名</th>
                        <th>連絡先</th>
                        <th>年齢・職業</th>
                        <th>希望条件</th>
                        <th>ステータス</th>
                        <th>登録日</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="customer-tbody">
                    <!-- 顧客データがここに動的に挿入されます -->
                </tbody>
            </table>
        </div>

        <!-- ページネーション -->
        <div class="pagination" id="pagination">
            <!-- ページネーションがここに動的に挿入されます -->
        </div>
    </main>

    <!-- 顧客追加・編集フォーム（モーダル） -->
    <div id="customer-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">新規顧客追加</h2>
                <button class="modal-close" onclick="customerManager.hideForm()">×</button>
            </div>
            <form id="customer-form" class="customer-form">
                <input type="hidden" id="customer-id" name="id">
                
                <!-- 基本情報 -->
                <div class="form-section">
                    <h3>基本情報</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="name">お名前 <span class="required">*</span></label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-field">
                            <label for="email">メールアドレス</label>
                            <input type="email" id="email" name="email">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="phone">電話番号</label>
                            <input type="tel" id="phone" name="phone">
                        </div>
                        <div class="form-field">
                            <label for="age">年齢</label>
                            <input type="number" id="age" name="age" min="18" max="100">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="occupation">職業</label>
                            <input type="text" id="occupation" name="occupation">
                        </div>
                        <div class="form-field">
                            <label for="annualIncome">年収（万円）</label>
                            <input type="number" id="annualIncome" name="annualIncome" min="0">
                        </div>
                    </div>
                </div>

                <!-- 希望条件 -->
                <div class="form-section">
                    <h3>希望条件</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="budgetMin">予算下限（円）</label>
                            <input type="number" id="budgetMin" name="preferences.budgetMin" min="0">
                        </div>
                        <div class="form-field">
                            <label for="budgetMax">予算上限（円）</label>
                            <input type="number" id="budgetMax" name="preferences.budgetMax" min="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="areas">希望エリア（カンマ区切り）</label>
                            <input type="text" id="areas" name="preferences.areas" placeholder="渋谷区, 新宿区, 品川区">
                        </div>
                        <div class="form-field">
                            <label for="roomType">間取り</label>
                            <select id="roomType" name="preferences.roomType">
                                <option value="">選択してください</option>
                                <option value="1R">1R</option>
                                <option value="1K">1K</option>
                                <option value="1DK">1DK</option>
                                <option value="1LDK">1LDK</option>
                                <option value="2K">2K</option>
                                <option value="2DK">2DK</option>
                                <option value="2LDK">2LDK</option>
                                <option value="3LDK">3LDK</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ステータス・メモ -->
                <div class="form-section">
                    <h3>ステータス・メモ</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="pipelineStatus">現在のステータス</label>
                            <select id="pipelineStatus" name="pipelineStatus">
                                <option value="初回相談">初回相談</option>
                                <option value="物件紹介">物件紹介</option>
                                <option value="内見">内見</option>
                                <option value="申込">申込</option>
                                <option value="審査">審査</option>
                                <option value="契約">契約</option>
                                <option value="完了">完了</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-field">
                        <label for="notes">メモ・特記事項</label>
                        <textarea id="notes" name="notes" rows="3"></textarea>
                    </div>
                </div>

                <!-- フォームボタン -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="customerManager.hideForm()">キャンセル</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- クイック登録フォーム（モーダル） -->
    <div id="quick-add-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>クイック登録</h2>
                <button class="modal-close" onclick="customerManager.hideQuickForm()">×</button>
            </div>
            <form id="quick-add-form" class="customer-form">
                <p class="form-description">最小限の情報で素早く顧客を登録できます。詳細は後から編集可能です。</p>
                
                <div class="form-row">
                    <div class="form-field">
                        <label for="quick-name">お名前 <span class="required">*</span></label>
                        <input type="text" id="quick-name" name="name" required>
                    </div>
                    <div class="form-field">
                        <label for="quick-phone">電話番号</label>
                        <input type="tel" id="quick-phone" name="phone">
                    </div>
                </div>

                <div class="form-field">
                    <label for="quick-status">現在のステータス</label>
                    <select id="quick-status" name="pipelineStatus">
                        <option value="初回相談">初回相談</option>
                        <option value="物件紹介">物件紹介</option>
                        <option value="内見">内見</option>
                        <option value="申込">申込</option>
                        <option value="審査">審査</option>
                        <option value="契約">契約</option>
                        <option value="完了">完了</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="quick-notes">メモ（任意）</label>
                    <textarea id="quick-notes" name="notes" rows="2" placeholder="簡単な特記事項があれば記入"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="customerManager.hideQuickForm()">キャンセル</button>
                    <button type="submit" class="btn btn-primary">クイック登録</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/firebase-config.js"></script>
    <script src="js/error-handler.js"></script>
    <script src="js/customer.js"></script>
    <script src="js/export.js"></script>
    <script>
        // ナビゲーション制御
        document.getElementById('nav-toggle').addEventListener('click', function() {
            document.getElementById('nav-menu').classList.toggle('active');
        });
    </script>
</body>
</html>
