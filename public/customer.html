<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡§å®¢ç®¡ç† - RentPipe</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-description {
            color: #6b7280;
            margin-top: 8px;
        }
        
        .auth-status {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .auth-status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .auth-status.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        
        .auth-status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .stat-icon {
            font-size: 32px;
        }
        
        .stat-content h3 {
            margin: 0;
            font-size: 28px;
            color: #1f2937;
        }
        
        .stat-content p {
            margin: 5px 0 0 0;
            color: #6b7280;
            font-size: 14px;
        }
        
        .search-filter-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .search-box {
            margin-bottom: 15px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .filter-section {
            margin-bottom: 15px;
        }
        
        .filter-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .customer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .customer-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }
        
        /* ğŸ†• éã‚¢ã‚¯ãƒ†ã‚£ãƒ–é¡§å®¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .customer-card.inactive {
            opacity: 0.7;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
        }
        
        .customer-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .customer-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .customer-name {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        /* ğŸ†• ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒã‚¸ */
        .active-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .active-badge.active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .active-badge.inactive {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .customer-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .customer-info {
            margin-bottom: 8px;
            color: #6b7280;
            font-size: 14px;
        }
        
        .customer-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
            flex-wrap: wrap;
        }
        
        .btn-edit, .btn-delete, .btn-deactivate, .btn-activate {
            flex: 1;
            min-width: 80px;
            padding: 8px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-edit {
            background: #3b82f6;
            color: white;
        }
        
        .btn-edit:hover {
            background: #2563eb;
        }
        
        .btn-delete {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .btn-delete:hover {
            background: #fecaca;
        }
        
        /* ğŸ†• éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ãƒœã‚¿ãƒ³ */
        .btn-deactivate {
            background: #fef3c7;
            color: #92400e;
        }
        
        .btn-deactivate:hover {
            background: #fde68a;
        }
        
        /* ğŸ†• å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ãƒœã‚¿ãƒ³ */
        .btn-activate {
            background: #d1fae5;
            color: #065f46;
        }
        
        .btn-activate:hover {
            background: #a7f3d0;
        }
        
        /* ğŸ†• ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-content {
            background: white;
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
        }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- ğŸ†• ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>å‡¦ç†ä¸­...</p>
        </div>
    </div>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div id="navigation"></div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="main-content">
        <div class="page-header">
            <div>
                <h1>ğŸ‘¥ é¡§å®¢ç®¡ç†</h1>
                <p class="page-description">ã™ã¹ã¦ã®é¡§å®¢æƒ…å ±ã‚’ä¸€å…ƒç®¡ç†ï¼ˆGoogle Sheetsè‡ªå‹•åŒæœŸï¼‰</p>
            </div>
            <a href="customer-form.html" class="btn btn-primary">â• æ–°è¦é¡§å®¢ç™»éŒ²</a>
        </div>

        <!-- èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
        <div id="auth-sync-status" class="auth-status warning">
            âš¡ èª­ã¿è¾¼ã¿ä¸­...
        </div>

        <!-- çµ±è¨ˆ -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-content">
                    <h3 id="stat-total">0</h3>
                    <p>ç·é¡§å®¢æ•°</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">âœ…</div>
                <div class="stat-content">
                    <h3 id="stat-active">0</h3>
                    <p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">â¸ï¸</div>
                <div class="stat-content">
                    <h3 id="stat-inactive">0</h3>
                    <p>éã‚¢ã‚¯ãƒ†ã‚£ãƒ–</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ†•</div>
                <div class="stat-content">
                    <h3 id="stat-new">0</h3>
                    <p>ä»Šæœˆã®æ–°è¦</p>
                </div>
            </div>
        </div>

        <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="search-filter-container">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="ğŸ” é¡§å®¢åã€ãƒ¡ãƒ¼ãƒ«ã€é›»è©±ç•ªå·ã§æ¤œç´¢..." onkeyup="searchCustomers()">
            </div>
            
            <!-- ğŸ†• ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
            <div class="filter-section">
                <div class="filter-section-title">è¡¨ç¤ºå¯¾è±¡</div>
                <div class="filter-buttons">
                    <button class="filter-btn active" id="filter-active-only" onclick="filterByActiveStatus('active')">âœ… ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã®ã¿</button>
                    <button class="filter-btn" id="filter-all" onclick="filterByActiveStatus('all')">ğŸ“‹ ã™ã¹ã¦è¡¨ç¤º</button>
                    <button class="filter-btn" id="filter-inactive-only" onclick="filterByActiveStatus('inactive')">â¸ï¸ éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã®ã¿</button>
                </div>
            </div>
            
            <!-- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
            <div class="filter-section">
                <div class="filter-section-title">ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                <div class="filter-buttons">
                    <button class="filter-btn active" id="status-all" onclick="filterByStatus('all')">ã™ã¹ã¦</button>
                    <button class="filter-btn" onclick="filterByStatus('åˆå›ç›¸è«‡')">åˆå›ç›¸è«‡</button>
                    <button class="filter-btn" onclick="filterByStatus('ç‰©ä»¶ç´¹ä»‹')">ç‰©ä»¶ç´¹ä»‹</button>
                    <button class="filter-btn" onclick="filterByStatus('å†…è¦‹')">å†…è¦‹</button>
                    <button class="filter-btn" onclick="filterByStatus('ç”³è¾¼')">ç”³è¾¼</button>
                    <button class="filter-btn" onclick="filterByStatus('å¯©æŸ»')">å¯©æŸ»</button>
                    <button class="filter-btn" onclick="filterByStatus('å¥‘ç´„')">å¥‘ç´„</button>
                    <button class="filter-btn" onclick="filterByStatus('å®Œäº†')">å®Œäº†</button>
                </div>
            </div>
        </div>

        <!-- é¡§å®¢ãƒªã‚¹ãƒˆ -->
        <div id="customer-list" class="customer-grid">
            <!-- é¡§å®¢ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
    </div>

    <!-- Google API Client & Identity Services -->
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    
    <!-- RentPipe Core Scripts -->
    <script src="js/navigation.js"></script>
    <script src="js/integrated-auth-manager-v2.js"></script>
    
    <!-- Google Integration Scripts -->
    <script src="js/google-drive-api-v2.js"></script>
    <script src="js/google-sheets-api.js"></script>
    
    <!-- Data Management -->
    <script src="js/unified-sheets-manager.js"></script>
    <script src="js/unified-data-manager.js"></script>
    
    <!-- âœ… çµ±åˆåˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="js/app-initializer.js"></script>
    
    <!-- Customer Management Functions -->
    <script>
        let currentStatusFilter = 'all';
        let currentActiveFilter = 'active'; // ğŸ†• ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã®ã¿
        let allCustomers = [];
        
        // ğŸ†• ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showLoading() {
            document.getElementById('loading-overlay').classList.add('active');
        }
        
        function hideLoading() {
            document.getElementById('loading-overlay').classList.remove('active');
        }
        
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–å¾Œã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // ğŸš€ å³åº§ã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºï¼ˆåŒæœŸã‚’å¾…ãŸãªã„ï¼‰
                displayCustomers();
                updateStats();
                
                // èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°
                function updateAuthStatusDisplay() {
                    const statusElement = document.getElementById('auth-sync-status');
                    if (!statusElement) return;
                    
                    const status = AppInitializer.getInitializationStatus();
                    
                    if (status.isInitialized && status.isAuthenticated) {
                        statusElement.innerHTML = 'âœ… åŒæœŸæ¸ˆã¿';
                        statusElement.className = 'auth-status synced';
                    } else {
                        statusElement.innerHTML = 'â³ åŒæœŸä¸­...';
                        statusElement.className = 'auth-status syncing';
                    }
                }
                
                // åˆå›è¡¨ç¤º
                updateAuthStatusDisplay();
                
                // å®šæœŸçš„ã«æ›´æ–°
                setInterval(updateAuthStatusDisplay, 2000);
                
                // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åŒæœŸå®Œäº†æ™‚ï¼‰
                window.addEventListener('rentpipe-data-updated', () => {
                    console.log('ğŸ”” ãƒ‡ãƒ¼ã‚¿æ›´æ–°é€šçŸ¥å—ä¿¡ - å†è¡¨ç¤º');
                    displayCustomers();
                    updateStats();
                    updateAuthStatusDisplay();
                });
                
            } catch (error) {
                console.error('customer.html åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        });
        
        // é¡§å®¢è¡¨ç¤º
        function displayCustomers() {
            allCustomers = window.UnifiedDataManager.getCustomers();
            console.log('ğŸ“Š é¡§å®¢ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º:', allCustomers.length, 'ä»¶');
            
            const container = document.getElementById('customer-list');
            container.innerHTML = '';
            
            // ğŸ†• ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
            let filteredCustomers = allCustomers;
            
            if (currentActiveFilter === 'active') {
                filteredCustomers = filteredCustomers.filter(c => c.isActive !== false);
            } else if (currentActiveFilter === 'inactive') {
                filteredCustomers = filteredCustomers.filter(c => c.isActive === false);
            }
            
            // ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
            if (currentStatusFilter !== 'all') {
                filteredCustomers = filteredCustomers.filter(c => c.pipelineStatus === currentStatusFilter);
            }
            
            if (filteredCustomers.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 40px;">è©²å½“ã™ã‚‹é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            filteredCustomers.forEach(customer => {
                const card = createCustomerCard(customer);
                container.appendChild(card);
            });
        }
        
        // é¡§å®¢ã‚«ãƒ¼ãƒ‰ä½œæˆ
        function createCustomerCard(customer) {
            const card = document.createElement('div');
            
            // ğŸ†• éã‚¢ã‚¯ãƒ†ã‚£ãƒ–é¡§å®¢ã«ã¯inactiveã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            const isInactive = customer.isActive === false;
            card.className = 'customer-card' + (isInactive ? ' inactive' : '');
            
            const statusColors = {
                'åˆå›ç›¸è«‡': '#fef3c7',
                'ç‰©ä»¶ç´¹ä»‹': '#dbeafe',
                'å†…è¦‹': '#e0e7ff',
                'ç”³è¾¼': '#fce7f3',
                'å¯©æŸ»': '#fed7aa',
                'å¥‘ç´„': '#d1fae5',
                'å®Œäº†': '#d1fae5'
            };
            
            // ğŸ†• ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒã‚¸
            const activeBadge = isInactive
                ? '<span class="active-badge inactive">â¸ï¸ éã‚¢ã‚¯ãƒ†ã‚£ãƒ–</span>'
                : '<span class="active-badge active">âœ… ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</span>';
            
            // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å¯¾å¿œ
            const name = customer.basicInfo?.name || customer.name || 'åå‰æœªè¨­å®š';
            const email = customer.basicInfo?.email || customer.email || 'ãƒ¡ãƒ¼ãƒ«ãªã—';
            const phone = customer.basicInfo?.phone || customer.phone || 'é›»è©±ç•ªå·ãªã—';
            const budgetMin = customer.preferences?.budget?.min || customer.preferences?.budgetMin || 0;
            const budgetMax = customer.preferences?.budget?.max || customer.preferences?.budgetMax || 0;
            const areas = customer.preferences?.areas || '';
            
            card.innerHTML = `
                <div class="customer-header">
                    <div>
                        <div class="customer-name">${name} ${activeBadge}</div>
                    </div>
                    <div class="customer-status" style="background: ${statusColors[customer.pipelineStatus] || '#f3f4f6'}">
                        ${customer.pipelineStatus || 'æœªè¨­å®š'}
                    </div>
                </div>
                <div class="customer-info">ğŸ“§ ${email}</div>
                <div class="customer-info">ğŸ“± ${phone}</div>
                ${budgetMin ? `
                    <div class="customer-info">ğŸ’° ${budgetMin.toLocaleString()}å†† ã€œ ${budgetMax ? budgetMax.toLocaleString() + 'å††' : ''}</div>
                ` : ''}
                ${areas ? `
                    <div class="customer-info">ğŸ“ ${areas}</div>
                ` : ''}
                <div class="customer-actions">
                    <button class="btn-edit" onclick="window.location.href='customer-form.html?edit=${customer.id}'">
                        ç·¨é›†
                    </button>
                    ${isInactive
                        ? `<button class="btn-activate" onclick="activateCustomer('${customer.id}')">â–¶ï¸ å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–</button>`
                        : `<button class="btn-deactivate" onclick="deactivateCustomer('${customer.id}')">â¸ï¸ éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–</button>`
                    }
                </div>
            `;
            
            return card;
        }

        
        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            const customers = window.UnifiedDataManager.getCustomers();
            
            document.getElementById('stat-total').textContent = customers.length;
            
            // ğŸ†• ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ•°
            const activeCount = customers.filter(c => c.isActive !== false).length;
            const inactiveCount = customers.filter(c => c.isActive === false).length;
            document.getElementById('stat-active').textContent = activeCount;
            document.getElementById('stat-inactive').textContent = inactiveCount;
            
            // ä»Šæœˆã®æ–°è¦
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            const newThisMonth = customers.filter(c => {
                const created = new Date(c.createdAt);
                return created.getMonth() === thisMonth && created.getFullYear() === thisYear;
            }).length;
            document.getElementById('stat-new').textContent = newThisMonth;
        }
        
        // æ¤œç´¢
        function searchCustomers() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            if (!searchTerm) {
                displayCustomers();
                return;
            }
            
            const filtered = allCustomers.filter(c => {
                return (c.name && c.name.toLowerCase().includes(searchTerm)) ||
                       (c.email && c.email.toLowerCase().includes(searchTerm)) ||
                       (c.phone && c.phone.includes(searchTerm));
            });
            
            const container = document.getElementById('customer-list');
            container.innerHTML = '';
            
            if (filtered.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 40px;">è©²å½“ã™ã‚‹é¡§å®¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            filtered.forEach(customer => {
                const card = createCustomerCard(customer);
                container.appendChild(card);
            });
        }
        
        // ğŸ†• ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        function filterByActiveStatus(filter) {
            currentActiveFilter = filter;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('#filter-active-only, #filter-all, #filter-inactive-only').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('filter-' + filter + (filter === 'all' ? '' : '-only')).classList.add('active');
            
            displayCustomers();
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        function filterByStatus(status) {
            currentStatusFilter = status;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.filter-buttons button').forEach(btn => {
                if (btn.id !== 'filter-active-only' && btn.id !== 'filter-all' && btn.id !== 'filter-inactive-only') {
                    btn.classList.remove('active');
                }
            });
            if (status === 'all') {
                document.getElementById('status-all').classList.add('active');
            } else {
                event.target.classList.add('active');
            }
            
            displayCustomers();
        }
        
        // ğŸ”§ é¡§å®¢ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ï¼ˆåŒæœŸå®Œäº†ã‚’ç¢ºå®Ÿã«å¾…ã¤ï¼‰
        async function deactivateCustomer(customerId) {
            const customer = window.UnifiedDataManager.getCustomerById(customerId);
            
            if (!customer) {
                alert('é¡§å®¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            const reason = prompt(
                `${customer.name}ã•ã‚“ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ã¾ã™ã‹?\n\n` +
                `ç†ç”±ã‚’é¸æŠã—ã¦ãã ã•ã„:\n` +
                `1. æˆç´„æ¸ˆã¿\n` +
                `2. å¤±æ³¨(ä»–ç¤¾ã§å¥‘ç´„)\n` +
                `3. é€£çµ¡é€”çµ¶\n` +
                `4. æ¡ä»¶ãŒåˆã‚ãªã„\n` +
                `5. ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n` +
                `6. ãã®ä»–\n\n` +
                `ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„(1-6):`,
                '1'
            );
            
            if (!reason) {
                return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            }
            
            const reasons = {
                '1': 'æˆç´„æ¸ˆã¿',
                '2': 'å¤±æ³¨(ä»–ç¤¾ã§å¥‘ç´„)',
                '3': 'é€£çµ¡é€”çµ¶',
                '4': 'æ¡ä»¶ãŒåˆã‚ãªã„',
                '5': 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
                '6': 'ãã®ä»–'
            };
            
            try {
                // ğŸ”§ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
                showLoading();
                
                console.log('â¸ï¸ éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–å‡¦ç†é–‹å§‹:', customerId);
                
                // ğŸ”§ åŒæœŸå®Œäº†ã‚’ç¢ºå®Ÿã«å¾…ã¤
                await window.UnifiedDataManager.deactivateCustomer(
                    customerId, 
                    reasons[reason] || 'ãã®ä»–'
                );
                
                console.log('âœ… éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–å‡¦ç†å®Œäº†');
                
                // ğŸ”§ UIæ›´æ–°
                displayCustomers();
                updateStats();
                
                // ğŸ”§ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
                hideLoading();
                
                alert(`âœ… ${customer.name}ã•ã‚“ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ã¾ã—ãŸ`);
                
            } catch (error) {
                console.error('âŒ éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã‚¨ãƒ©ãƒ¼:', error);
                hideLoading();
                alert('éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }
        
        // ğŸ”§ é¡§å®¢ã‚’å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ï¼ˆåŒæœŸå®Œäº†ã‚’ç¢ºå®Ÿã«å¾…ã¤ï¼‰
        async function activateCustomer(customerId) {
            const customer = window.UnifiedDataManager.getCustomerById(customerId);
            
            if (!customer) {
                alert('é¡§å®¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            if (!confirm(`${customer.name}ã•ã‚“ã‚’å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã—ã¾ã™ã‹?`)) {
                return;
            }
            
            try {
                // ğŸ”§ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
                showLoading();
                
                console.log('â–¶ï¸ å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–å‡¦ç†é–‹å§‹:', customerId);
                
                // ğŸ”§ åŒæœŸå®Œäº†ã‚’ç¢ºå®Ÿã«å¾…ã¤
                await window.UnifiedDataManager.activateCustomer(customerId);
                
                console.log('âœ… å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–å‡¦ç†å®Œäº†');
                
                // ğŸ”§ UIæ›´æ–°
                displayCustomers();
                updateStats();
                
                // ğŸ”§ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
                hideLoading();
                
                alert(`âœ… ${customer.name}ã•ã‚“ã‚’å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã—ã¾ã—ãŸ`);
                
            } catch (error) {
                console.error('âŒ å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã‚¨ãƒ©ãƒ¼:', error);
                hideLoading();
                alert('å†ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }
        
        // é¡§å®¢å‰Šé™¤
        async function deleteCustomer(customerId) {
            if (!confirm('ã“ã®é¡§å®¢ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹?')) {
                return;
            }
            
            try {
                showLoading();
                await window.UnifiedDataManager.deleteCustomer(customerId);
                displayCustomers();
                updateStats();
                hideLoading();
                alert('âœ… é¡§å®¢ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                hideLoading();
                alert('âŒ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
    </script>
</body>
</html>
