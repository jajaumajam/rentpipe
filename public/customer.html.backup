<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡§å®¢ç®¡ç† - RentPipe</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .nav-user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 14px;
            margin-right: 15px;
        }
        
        .google-forms-section {
            margin: 1rem 0 2rem 0;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }
        
        .forms-auth-required {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
        }
        
        .forms-auth-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .google-forms-buttons {
            margin-top: 15px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .google-forms-buttons .btn {
            margin: 0 5px;
            font-size: 14px;
        }
        
        .form-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .form-status.created {
            background: #d1fae5;
            color: #065f46;
        }
        
        .form-status.not-created {
            background: #fef3c7;
            color: #92400e;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ğŸ  RentPipe</h1>
            <nav class="nav-container">
                <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
                <a href="customer.html" class="active">é¡§å®¢ç®¡ç†</a>
                <a href="customer-minimal.html">ç°¡æ˜“ç‰ˆ</a>
                <a href="pipeline.html">ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</a>
                <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div class="nav-user-info" id="nav-user-display"></div>
                <button onclick="handleLogout()" class="btn btn-outline nav-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="page-header">
            <h2>ğŸ‘¥ é¡§å®¢ç®¡ç†</h2>
            <p>é¡§å®¢æƒ…å ±ã®ç®¡ç†ã¨Google Formsé€£æºï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰</p>
        </div>

        <!-- Google Formsé€£æºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="google-forms-section" class="google-forms-section">
            <h3>ğŸ“ Google Formsé€£æºï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰</h3>
            <p id="forms-status-text">é€£æºçŠ¶æ³ã‚’ç¢ºèªä¸­...</p>
            <div id="forms-action-area"></div>
        </div>

        <!-- èªè¨¼çŠ¶æ…‹è¡¨ç¤º -->
        <div id="auth-status" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: #f3f4f6;"></div>

        <!-- é¡§å®¢ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="customer-data-status" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: #e5f3ff;">
            <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿çŠ¶æ³</h3>
            <p id="data-loading-info">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            <button onclick="createTestCustomers()" class="btn btn-success">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
            <button onclick="loadCustomerData()" class="btn btn-info">ğŸ”„ ãƒªã‚¹ãƒˆæ›´æ–°</button>
            <button onclick="checkAllStorageKeys()" class="btn btn-warning">ğŸ” ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèª</button>
        </div>

        <!-- é¡§å®¢ãƒªã‚¹ãƒˆ -->
        <div id="customer-simple-list" class="customer-grid">
            <!-- é¡§å®¢ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
        </div>
    </main>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- å¿…è¦æœ€å°é™ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="js/simple-reliable-auth.js"></script>
    <script src="js/local-first-sync.js"></script>
    <script src="js/create-test-customers.js"></script>
    
    <!-- Google Formsé€£æºï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆãƒ»ãƒ‡ãƒãƒƒã‚°å¼·åŒ–ï¼‰ -->
    <script src="js/google-forms-mock-debug.js"></script>
    
    <script>
        // ğŸ”§ customer.html çµ±åˆç‰ˆï¼ˆGoogle Forms APIãƒ¢ãƒƒã‚¯ç‰ˆï¼‰
        console.log('ğŸš€ Customer ç®¡ç†ç”»é¢åˆæœŸåŒ–é–‹å§‹ï¼ˆGoogle Forms APIãƒ¢ãƒƒã‚¯ç‰ˆï¼‰');

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyBvJGdan0lvVSkaAbbSXQkoh6YyPoGyTgM",
            authDomain: "rentpipe-ab04e.firebaseapp.com",
            projectId: "rentpipe-ab04e",
            storageBucket: "rentpipe-ab04e.firebasestorage.app",
            messagingSenderId: "586040985916",
            appId: "1:586040985916:web:3cdb5db072f1a6569fb639"
        };
        firebase.initializeApp(firebaseConfig);

        // å†™çœŸè¡¨ç¤ºãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        const PhotoUtils = {
            photoStatus: new Map(),
            
            createSafePhotoElement: function(photoURL, size = 'normal', fallbackText = 'ğŸ‘¤', trackingId = null) {
                if (!photoURL) {
                    return this.createPlaceholder(size, fallbackText);
                }
                
                const img = document.createElement('img');
                const className = size === 'small' ? 'user-photo-small' : 'user-photo-normal';
                img.className = className;
                
                img.onload = () => {
                    console.log('âœ… å†™çœŸèª­ã¿è¾¼ã¿æˆåŠŸ:', trackingId);
                };
                
                img.onerror = () => {
                    console.log('âŒ å†™çœŸèª­ã¿è¾¼ã¿å¤±æ•— - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«å¤‰æ›´:', trackingId);
                    img.style.display = 'none';
                    const placeholder = this.createPlaceholder(size, fallbackText);
                    img.parentNode.insertBefore(placeholder, img);
                };
                
                img.src = photoURL;
                return img;
            },
            
            createPlaceholder: function(size, text) {
                const span = document.createElement('span');
                span.className = size === 'small' ? 'user-photo-placeholder-small' : 'user-photo-placeholder';
                span.textContent = text;
                span.style.cssText = size === 'small' ? 
                    'display: inline-block; width: 24px; height: 24px; background: #6b7280; border-radius: 50%; text-align: center; line-height: 24px; font-size: 12px; color: white;' :
                    'display: inline-block; width: 32px; height: 32px; background: #6b7280; border-radius: 50%; text-align: center; line-height: 32px; font-size: 16px; color: white;';
                return span;
            }
        };

        // çµ±åˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
        const IntegratedAuth = {
            getAuthenticatedUser: function() {
                console.log('ğŸ” çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯é–‹å§‹...');
                
                // æ–¹æ³•1: simple-reliable-authæ–¹å¼
                const authSimple = localStorage.getItem('rentpipe_auth_simple');
                const userSimple = localStorage.getItem('rentpipe_user_simple');
                
                if (authSimple === 'logged_in' && userSimple) {
                    try {
                        const user = JSON.parse(userSimple);
                        console.log('âœ… simple-reliable-authèªè¨¼ç¢ºèª:', user.email);
                        return { authenticated: true, user: user, method: 'simple-reliable-auth' };
                    } catch (error) {
                        console.log('âŒ simple-reliable-authãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿è§£æå¤±æ•—:', error);
                    }
                }
                
                // æ–¹æ³•2: Googleèªè¨¼ãƒ•ãƒ©ã‚°æ–¹å¼
                const googleAuth = localStorage.getItem('rentpipe_temp_auth');
                const googleUser = localStorage.getItem('google_user_temp');
                
                if (googleAuth === 'google_authenticated' && googleUser) {
                    try {
                        const user = JSON.parse(googleUser);
                        console.log('âœ… Googleèªè¨¼ãƒ•ãƒ©ã‚°ã§èªè¨¼ç¢ºèª:', user.email);
                        return { authenticated: true, user: user, method: 'google-flag' };
                    } catch (error) {
                        console.log('âŒ Googleèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿è§£æå¤±æ•—:', error);
                    }
                }
                
                // æ–¹æ³•3: Firebaseèªè¨¼ï¼ˆéåŒæœŸï¼‰
                return new Promise((resolve) => {
                    firebase.auth().onAuthStateChanged((user) => {
                        if (user) {
                            console.log('âœ… Firebaseèªè¨¼ã§èªè¨¼ç¢ºèª:', user.email);
                            resolve({
                                authenticated: true,
                                user: {
                                    uid: user.uid,
                                    email: user.email,
                                    displayName: user.displayName,
                                    photoURL: user.photoURL,
                                    emailVerified: user.emailVerified
                                },
                                method: 'firebase'
                            });
                        } else {
                            console.log('âŒ Firebaseèªè¨¼: æœªèªè¨¼');
                            resolve(null);
                        }
                    });
                });
            },
            
            // Googleèªè¨¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
            isGoogleAuthenticated: function() {
                const googleAuth = localStorage.getItem('rentpipe_temp_auth');
                const result = (googleAuth === 'google_authenticated');
                console.log('ğŸ” Googleèªè¨¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯:', result);
                return result;
            }
        };

        // Google Formsé€£æºæ©Ÿèƒ½
        const GoogleFormsIntegration = {
            // Googleèªè¨¼çŠ¶æ…‹ã«åŸºã¥ãUIæ›´æ–°
            updateFormsSection: function() {
                const section = document.getElementById('google-forms-section');
                const statusText = document.getElementById('forms-status-text');
                const actionArea = document.getElementById('forms-action-area');
                
                if (IntegratedAuth.isGoogleAuthenticated()) {
                    // Googleèªè¨¼æ¸ˆã¿
                    section.className = 'google-forms-section forms-auth-success';
                    statusText.textContent = 'Googleèªè¨¼ãŒå®Œäº†ã—ã¦ã„ã¾ã™ã€‚é¡§å®¢å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã§ãã¾ã™ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰ã€‚';
                    actionArea.innerHTML = `
                        <p style="margin: 0.5rem 0; opacity: 0.9; font-size: 0.9rem;">
                            å„é¡§å®¢ã‚«ãƒ¼ãƒ‰ã®ã€ŒğŸ“ ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆã€ãƒœã‚¿ãƒ³ã‹ã‚‰å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã§ãã¾ã™ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰
                        </p>
                        <button onclick="testGoogleFormsAPI()" class="btn" style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; font-size: 12px; margin-top: 0.5rem;">
                            ğŸ­ ãƒ¢ãƒƒã‚¯ç‰ˆAPIæ¥ç¶šãƒ†ã‚¹ãƒˆ
                        </button>
                    `;
                } else {
                    // Googleèªè¨¼æœªå®Œäº†
                    section.className = 'google-forms-section forms-auth-required';
                    statusText.textContent = 'é¡§å®¢å°‚ç”¨ã®ç‰©ä»¶å¸Œæœ›èª¿æŸ»ãƒ•ã‚©ãƒ¼ãƒ ã‚’è‡ªå‹•ä½œæˆã™ã‚‹ã«ã¯Googleèªè¨¼ãŒå¿…è¦ã§ã™ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰';
                    actionArea.innerHTML = `
                        <button onclick="window.location.href='login.html'" class="btn" style="background: white; color: #1e40af; padding: 12px 24px; border: none; border-radius: 6px; font-weight: 600; margin-top: 1rem;">
                            ğŸ”‘ Googleèªè¨¼ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½ã‚’åˆ©ç”¨
                        </button>
                    `;
                }
            }
        };

        // DOMèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ“„ DOMèª­ã¿è¾¼ã¿å®Œäº†');
            
            try {
                // çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯
                await performIntegratedAuthCheck();
                
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º
                await displayAuthStatus();
                
                // Google Formsé€£æºçŠ¶æ³æ›´æ–°
                GoogleFormsIntegration.updateFormsSection();
                
                // é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                loadCustomerData();
                
            } catch (error) {
                console.error('âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        });

        // çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯
        async function performIntegratedAuthCheck() {
            console.log('ğŸ” çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ');
            
            try {
                const authResult = IntegratedAuth.getAuthenticatedUser();
                
                if (authResult && authResult.then) {
                    // éåŒæœŸï¼ˆFirebaseèªè¨¼ï¼‰
                    const result = await authResult;
                    if (!result) {
                        console.log('ğŸ”’ æœªèªè¨¼ - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ');
                        window.location.href = 'login.html';
                        return;
                    }
                    window.currentUser = result.user;
                    console.log('âœ… Firebaseèªè¨¼çµŒç”±ã§èªè¨¼ç¢ºèª:', result.user.email);
                    
                } else if (authResult) {
                    // åŒæœŸçš„ã«èªè¨¼ç¢ºèªæ¸ˆã¿
                    window.currentUser = authResult.user;
                    console.log('âœ… åŒæœŸèªè¨¼ã§èªè¨¼ç¢ºèª:', authResult.user.email);
                    
                } else {
                    // æœªèªè¨¼
                    console.log('ğŸ”’ çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯çµæœ: æœªèªè¨¼');
                    window.location.href = 'login.html';
                    return;
                }
                
            } catch (error) {
                console.error('âŒ çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', error);
                window.location.href = 'login.html';
            }
        }

        // èªè¨¼çŠ¶æ…‹è¡¨ç¤º
        async function displayAuthStatus() {
            const authDiv = document.getElementById('auth-status');
            const navUserInfo = document.getElementById('nav-user-display');
            
            if (window.currentUser) {
                console.log('ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤ºé–‹å§‹:', window.currentUser);
                
                // å†™çœŸè¦ç´ ä½œæˆ
                const trackingId = 'main-user-photo';
                const photoElement = PhotoUtils.createSafePhotoElement(
                    window.currentUser.photoURL,
                    'normal',
                    window.currentUser.displayName ? window.currentUser.displayName[0].toUpperCase() : 'ğŸ‘¤',
                    trackingId
                );
                
                // èªè¨¼çŠ¶æ…‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                authDiv.className = 'section success';
                authDiv.innerHTML = `
                    <h3>âœ… èªè¨¼æ¸ˆã¿ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆå¯¾å¿œï¼‰</h3>
                    <div style="display: flex; align-items: center; gap: 12px; margin-top: 10px;">
                        ${photoElement.outerHTML}
                        <div>
                            <div><strong>${window.currentUser.displayName || 'åå‰æœªè¨­å®š'}</strong></div>
                            <div style="color: #666; font-size: 14px;">${window.currentUser.email}</div>
                        </div>
                    </div>
                `;
                
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
                const navPhotoElement = PhotoUtils.createSafePhotoElement(
                    window.currentUser.photoURL,
                    'small',
                    window.currentUser.displayName ? window.currentUser.displayName[0].toUpperCase() : 'ğŸ‘¤',
                    'nav-user-photo'
                );
                
                navUserInfo.innerHTML = `
                    ${navPhotoElement.outerHTML}
                    <span>${window.currentUser.displayName || window.currentUser.email.split('@')[0]}</span>
                `;
                
            } else {
                authDiv.className = 'section error';
                authDiv.innerHTML = '<h3>âŒ æœªèªè¨¼</h3><p>ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä¸­...</p>';
            }
        }

        // é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadCustomerData() {
            console.log('ğŸ“Š é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
            
            const dataStatus = document.getElementById('data-loading-info');
            const customerList = document.getElementById('customer-simple-list');
            
            try {
                // è¤‡æ•°ã®å¯èƒ½ãªã‚­ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
                const possibleKeys = [
                    'customers',               // create-test-customers.jsãŒä½¿ç”¨
                    'rentpipe_demo_customers', // ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä½¿ç”¨
                    'rentpipe_customers',      // åˆ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä½¿ç”¨
                    'demo_customers'           // ãƒ†ã‚¹ãƒˆç”¨
                ];
                
                let customers = null;
                let usedKey = null;
                
                for (const key of possibleKeys) {
                    const storedData = localStorage.getItem(key);
                    if (storedData) {
                        try {
                            const parsedData = JSON.parse(storedData);
                            if (Array.isArray(parsedData) && parsedData.length > 0) {
                                customers = parsedData;
                                usedKey = key;
                                break;
                            }
                        } catch (parseError) {
                            console.warn(`ã‚­ãƒ¼ ${key} ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:`, parseError);
                        }
                    }
                }
                
                if (customers) {
                    console.log(`âœ… é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ: ${customers.length}ä»¶ï¼ˆã‚­ãƒ¼: ${usedKey}ï¼‰`);
                    dataStatus.textContent = `é¡§å®¢ãƒ‡ãƒ¼ã‚¿: ${customers.length}ä»¶èª­ã¿è¾¼ã¿å®Œäº†ï¼ˆã‚­ãƒ¼: ${usedKey}ï¼‰`;
                    displayCustomers(customers);
                } else {
                    console.log('âš ï¸ é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãªã—');
                    dataStatus.textContent = 'ã¾ã é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€ŒğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚';
                    customerList.innerHTML = '<p style="text-align: center; color: #666;">é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                }
            } catch (error) {
                console.error('âŒ é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                dataStatus.textContent = 'ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                customerList.innerHTML = '<p style="text-align: center; color: #dc2626;">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
            }
        }

        // å…¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ç¢ºèªï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        function checkAllStorageKeys() {
            console.log('ğŸ” å…¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ç¢ºèª');
            
            const allKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                allKeys.push(localStorage.key(i));
            }
            
            console.log('ğŸ“‹ å…¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼:', allKeys);
            
            // é¡§å®¢ãƒ‡ãƒ¼ã‚¿é–¢é€£ã®ã‚­ãƒ¼ã®ã¿ãƒã‚§ãƒƒã‚¯
            const customerRelatedKeys = allKeys.filter(key => 
                key.includes('customer') || key.includes('demo') || key === 'customers'
            );
            
            console.log('ğŸ‘¥ é¡§å®¢é–¢é€£ã‚­ãƒ¼:', customerRelatedKeys);
            
            // çµæœã‚’ç”»é¢è¡¨ç¤º
            const dataStatus = document.getElementById('data-loading-info');
            dataStatus.innerHTML = `
                <strong>ğŸ” ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ç¢ºèªçµæœ:</strong><br>
                å…¨ã‚­ãƒ¼æ•°: ${allKeys.length}<br>
                é¡§å®¢é–¢é€£ã‚­ãƒ¼: ${customerRelatedKeys.join(', ') || 'ãªã—'}<br>
                <small>è©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„</small>
            `;
            
            // å„é¡§å®¢é–¢é€£ã‚­ãƒ¼ã®å†…å®¹ã‚‚ç¢ºèª
            customerRelatedKeys.forEach(key => {
                const data = localStorage.getItem(key);
                try {
                    const parsed = JSON.parse(data);
                    console.log(`ğŸ“Š ${key}:`, parsed);
                } catch (e) {
                    console.log(`ğŸ“Š ${key} (æ–‡å­—åˆ—):`, data);
                }
            });
        }

        // é¡§å®¢è¡¨ç¤ºï¼ˆGoogle Formsé€£æºãƒœã‚¿ãƒ³ä»˜ãï¼‰
        function displayCustomers(customers) {
            const container = document.getElementById('customer-simple-list');
            container.innerHTML = '';
            
            customers.forEach((customer, index) => {
                const customerCard = document.createElement('div');
                customerCard.className = 'customer-card';
                customerCard.style.cssText = 'border: 1px solid #ddd; border-radius: 8px; padding: 1rem; margin: 0.5rem; background: white;';
                
                // Googleèªè¨¼çŠ¶æ…‹ã«åŸºã¥ããƒœã‚¿ãƒ³è¡¨ç¤º
                const isGoogleAuth = IntegratedAuth.isGoogleAuthenticated();
                const hasGoogleForm = customer.googleForm && customer.googleForm.formId;
                
                let formsButtonHTML = '';
                
                if (!isGoogleAuth) {
                    formsButtonHTML = `<div class="google-forms-buttons">
                        <p style="font-size: 14px; color: #666; margin: 5px 0;">Googleèªè¨¼å¾Œã«ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰</p>
                    </div>`;
                } else if (hasGoogleForm) {
                    // ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆæ¸ˆã¿
                    const mockBadge = customer.googleForm.isMock ? ' ğŸ­' : '';
                    formsButtonHTML = `<div class="google-forms-buttons">
                        <span class="form-status created">âœ… ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆæ¸ˆã¿${mockBadge}</span>
                        <div style="margin-top: 8px;">
                            <button onclick="alert('ãƒ¢ãƒƒã‚¯ç‰ˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚å®Ÿéš›ã®ãƒ•ã‚©ãƒ¼ãƒ ã¯ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')" class="btn btn-success btn-sm">ğŸ”— ãƒ•ã‚©ãƒ¼ãƒ ç¢ºèª${mockBadge}</button>
                            <button onclick="alert('ãƒ¢ãƒƒã‚¯ç‰ˆã§ã™ã€‚ç·¨é›†æ©Ÿèƒ½ã¯å®Ÿè£…äºˆå®šã§ã™ã€‚')" class="btn btn-info btn-sm">âš™ï¸ ç·¨é›†${mockBadge}</button>
                            <button onclick="viewFormResponses('${customer.id}')" class="btn btn-warning btn-sm">ğŸ“Š å›ç­”ç¢ºèª${mockBadge}</button>
                        </div>
                    </div>`;
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ æœªä½œæˆ
                    formsButtonHTML = `<div class="google-forms-buttons">
                        <span class="form-status not-created">ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ æœªä½œæˆ</span>
                        <div style="margin-top: 8px;">
                            <button onclick="createCustomerForm('${customer.id}', ${index})" class="btn btn-primary btn-sm">ğŸ­ å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰</button>
                        </div>
                    </div>`;
                }
                
                customerCard.innerHTML = `
                    <div style="display: flex; justify-content: between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 8px 0; color: #1f2937;">${customer.name}</h4>
                            <p style="margin: 0 0 4px 0; font-size: 14px; color: #6b7280;">ğŸ“§ ${customer.email}</p>
                            <p style="margin: 0 0 4px 0; font-size: 14px; color: #6b7280;">ğŸ“ ${customer.phone}</p>
                            <p style="margin: 0 0 4px 0; font-size: 14px; color: #6b7280;">ğŸ’° äºˆç®—: ${customer.preferences ? customer.preferences.budgetMin + '-' + customer.preferences.budgetMax + 'ä¸‡å††' : 'æœªè¨­å®š'}</p>
                            <p style="margin: 0; font-size: 14px; color: #6b7280;">ğŸ  å¸Œæœ›ã‚¨ãƒªã‚¢: ${customer.preferences ? customer.preferences.areas.join(', ') : 'æœªè¨­å®š'}</p>
                        </div>
                        <div style="margin-left: 15px;">
                            <button onclick="showCustomerDetail('${customer.id}')" class="btn btn-outline btn-sm">è©³ç´°</button>
                        </div>
                    </div>
                    ${formsButtonHTML}
                `;
                
                container.appendChild(customerCard);
            });
        }

        // ãƒ•ã‚©ãƒ¼ãƒ å›ç­”ç¢ºèªï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
        function viewFormResponses(customerId) {
            console.log('ğŸ“Š ãƒ•ã‚©ãƒ¼ãƒ å›ç­”ç¢ºèª:', customerId);
            alert(`ğŸ­ ãƒ¢ãƒƒã‚¯ç‰ˆ: é¡§å®¢ID ${customerId} ã®ãƒ•ã‚©ãƒ¼ãƒ å›ç­”ç¢ºèªæ©Ÿèƒ½\n\nå®Ÿè£…äºˆå®šã®æ©Ÿèƒ½ã§ã™ã€‚`);
        }

        // Google Forms API ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰
        function testGoogleFormsAPI() {
            console.log('ğŸ­ Google Forms APIæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰');
            
            if (window.GoogleFormsSimple) {
                window.GoogleFormsSimple.initialize().then(result => {
                    if (result) {
                        alert('âœ… Google Forms APIæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸï¼ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰\n\nãƒ•ã‚©ãƒ¼ãƒ ä½œæˆæ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚');
                    } else {
                        alert('âŒ Google Forms APIæ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰\n\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ã”ç¢ºèªãã ã•ã„ã€‚');
                    }
                });
            } else {
                alert('âŒ GoogleFormsSimpleï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
            }
        }

        // é¡§å®¢è©³ç´°è¡¨ç¤º
        function showCustomerDetail(customerId) {
            console.log('ğŸ‘¤ é¡§å®¢è©³ç´°è¡¨ç¤º:', customerId);
            window.location.href = `customer-detail.html?id=${customerId}`;
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
        function handleLogout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                // å„èªè¨¼æ–¹å¼ã‚’ã‚¯ãƒªã‚¢
                localStorage.removeItem('rentpipe_auth_simple');
                localStorage.removeItem('rentpipe_user_simple');
                localStorage.removeItem('rentpipe_temp_auth');
                localStorage.removeItem('google_user_temp');
                localStorage.removeItem('google_access_token');
                
                // Firebaseã‹ã‚‰ã‚‚ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                firebase.auth().signOut().then(() => {
                    console.log('âœ… å…¨èªè¨¼ã‹ã‚‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå®Œäº†');
                    window.location.href = 'login.html';
                });
            }
        }

        console.log('âœ… Customer ç®¡ç†ç”»é¢ï¼ˆGoogle Forms APIãƒ¢ãƒƒã‚¯ç‰ˆï¼‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆæº–å‚™å®Œäº†');
    </script>
</body>
</html>
