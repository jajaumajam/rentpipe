<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Apps Scriptè¨­å®šç¢ºèªãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .step {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            color: #991b1b;
        }
        
        .success {
            background: #d1fae5;
            border: 1px solid #10b981;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            color: #065f46;
        }
        
        .btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .btn-success { background: #34a853; }
        .btn-warning { background: #f59e0b; }
        .btn-danger { background: #ef4444; }
        
        .url-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .checklist {
            list-style-type: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .checklist li:before {
            content: "â˜ ";
            margin-right: 8px;
        }
        
        .checklist li.checked:before {
            content: "âœ… ";
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Google Apps Scriptè¨­å®šç¢ºèªãƒ„ãƒ¼ãƒ«</h1>
    
    <!-- Load failedã‚¨ãƒ©ãƒ¼ã®èª¬æ˜ -->
    <div class="section">
        <h2>ğŸš¨ ã€ŒLoad failedã€ã‚¨ãƒ©ãƒ¼ã«ã¤ã„ã¦</h2>
        <div class="error">
            <strong>ã€ŒLoad failedã€ã‚¨ãƒ©ãƒ¼ã®åŸå› :</strong><br>
            Google Apps ScriptãŒæ­£ã—ãè¨­å®šãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>
            ã“ã®ãŸã‚ã€RentPipeã®ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆãŒå¤ã„APIã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã€400ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚
        </div>
        
        <div class="step">
            <strong>è§£æ±ºã®æµã‚Œ:</strong><br>
            1. Google Apps Scriptã®è¨­å®šã‚’ä¸€ã‹ã‚‰ç¢ºèª<br>
            2. æ­£ã—ã„ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª<br>
            3. æ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª<br>
            4. ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
        </div>
    </div>
    
    <!-- URLå½¢å¼ãƒã‚§ãƒƒã‚¯ -->
    <div class="section">
        <h2>ğŸ”— Step 1: URLå½¢å¼ãƒã‚§ãƒƒã‚¯</h2>
        <p>ä½¿ç”¨ã—ã¦ã„ã‚‹Google Apps Scriptã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š</p>
        <input type="text" id="gas-url-check" class="url-input" 
               placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
        <button class="btn" onclick="checkURLFormat()">URLå½¢å¼ç¢ºèª</button>
        <div id="url-check-result" class="step">
            URLã‚’å…¥åŠ›ã—ã¦ã€ŒURLå½¢å¼ç¢ºèªã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„
        </div>
    </div>
    
    <!-- Google Apps Scriptã‚³ãƒ¼ãƒ‰ç¢ºèª -->
    <div class="section">
        <h2>ğŸ“ Step 2: Google Apps Scriptã‚³ãƒ¼ãƒ‰ç¢ºèª</h2>
        <p>Google Apps Scriptã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼š</p>
        
        <div class="step">
            <strong>ğŸ” ç¢ºèªæ‰‹é †:</strong><br>
            1. <a href="https://script.google.com" target="_blank">script.google.com</a> ã‚’é–‹ã<br>
            2. ã€ŒRentPipe Forms Creatorã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã<br>
            3. ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
        </div>
        
        <div class="code-block">// å¿…é ˆé–¢æ•°1: createCustomerForm
function createCustomerForm(customerData) {
  try {
    console.log('ğŸ“ é¡§å®¢å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆé–‹å§‹:', customerData.name);
    
    // ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
    const form = FormApp.create(customerData.name + 'æ§˜å°‚ç”¨ ç‰©ä»¶å¸Œæœ›èª¿æŸ»ãƒ•ã‚©ãƒ¼ãƒ  - RentPipe');
    
    // ... è³ªå•é …ç›®è¿½åŠ ã‚³ãƒ¼ãƒ‰ ...
    
    return {
      success: true,
      form: {
        id: form.getId(),
        title: form.getTitle(),
        url: form.getPublishedUrl(),
        editUrl: form.getEditUrl(),
        responsesUrl: `https://docs.google.com/forms/d/${form.getId()}/responses`,
        createdAt: new Date().toISOString()
      }
    };
  } catch (error) {
    return {
      success: false,
      error: error.toString()
    };
  }
}

// å¿…é ˆé–¢æ•°2: doPostï¼ˆã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªç”¨ï¼‰
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const result = createCustomerForm(data.customerData);
    
    return ContentService
      .createTextOutput(JSON.stringify(result))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        error: error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}</div>
        
        <button class="btn btn-success" onclick="showFullCode()">å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º</button>
        <div id="full-code" style="display: none;">
            <h4>ğŸ“‹ å®Œå…¨ãªGoogle Apps Scriptã‚³ãƒ¼ãƒ‰:</h4>
            <div class="code-block" id="complete-code">ã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
    </div>
    
    <!-- ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šç¢ºèª -->
    <div class="section">
        <h2>ğŸš€ Step 3: ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šç¢ºèª</h2>
        <div class="step">
            <strong>ğŸ” ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:</strong>
            <ul class="checklist">
                <li id="check-1">Google Apps Scriptã§ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜æ¸ˆã¿</li>
                <li id="check-2">ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’å®Ÿè¡Œæ¸ˆã¿</li>
                <li id="check-3">ç¨®é¡ã§ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’é¸æŠæ¸ˆã¿</li>
                <li id="check-4">å®Ÿè¡Œè€…ã‚’ã€Œè‡ªåˆ†ã€ã«è¨­å®šæ¸ˆã¿</li>
                <li id="check-5">ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã€Œå…¨å“¡ã€ã«è¨­å®šæ¸ˆã¿</li>
                <li id="check-6">ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã‚’å–å¾—æ¸ˆã¿</li>
                <li id="check-7">æ¨©é™ç¢ºèªã§ã€Œè¨±å¯ã€ã‚’é¸æŠæ¸ˆã¿</li>
            </ul>
        </div>
        
        <button class="btn btn-warning" onclick="showDeploySteps()">è©³ç´°ãªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã‚’è¡¨ç¤º</button>
        <div id="deploy-steps" style="display: none;">
            <div class="step">
                <strong>ğŸ“‹ è©³ç´°ãªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †:</strong><br><br>
                
                <strong>1. ã‚³ãƒ¼ãƒ‰ä¿å­˜:</strong><br>
                - Ctrl+S ã§ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜<br><br>
                
                <strong>2. ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹:</strong><br>
                - ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
                - ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯<br><br>
                
                <strong>3. ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š:</strong><br>
                - ç¨®é¡: ã€Œâš™ï¸ ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’é¸æŠ<br>
                - èª¬æ˜: ã€ŒRentPipe Forms Creator v1ã€<br>
                - å®Ÿè¡Œè€…: ã€Œè‡ªåˆ†ã€<br>
                - ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œå…¨å“¡ã€ âš ï¸é‡è¦<br><br>
                
                <strong>4. æ¨©é™è¨±å¯:</strong><br>
                - ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
                - ã€Œã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¢ºèªã€â†’ã€Œè©³ç´°è¨­å®šã€â†’ã€Œå®‰å…¨ã§ã¯ãªã„ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã€â†’ã€Œè¨±å¯ã€<br><br>
                
                <strong>5. URLå–å¾—:</strong><br>
                - ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã€ã‚’ã‚³ãƒ”ãƒ¼<br>
                - å½¢å¼: https://script.google.com/macros/s/.../exec
            </div>
        </div>
    </div>
    
    <!-- ä¿®æ­£æ¸ˆã¿URLæ¥ç¶šãƒ†ã‚¹ãƒˆ -->
    <div class="section">
        <h2>ğŸ§ª Step 4: ä¿®æ­£å¾Œæ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
        <p>ä¸Šè¨˜ã®è¨­å®šã‚’ä¿®æ­£ã—ãŸå¾Œã€å†åº¦æ¥ç¶šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š</p>
        <input type="text" id="fixed-gas-url" class="url-input" 
               placeholder="ä¿®æ­£å¾Œã®Google Apps Script URL">
        <button class="btn btn-success" onclick="testFixedGAS()">ä¿®æ­£å¾Œæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
        <div id="fixed-test-result" class="step">
            ä¿®æ­£å¾Œã®URLã§ãƒ†ã‚¹ãƒˆçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™
        </div>
    </div>
    
    <!-- ä»£æ›¿æ‰‹é † -->
    <div class="section">
        <h2>ğŸ”„ Step 5: ä»£æ›¿æ‰‹é †ï¼ˆä¸Šè¨˜ã§è§£æ±ºã—ãªã„å ´åˆï¼‰</h2>
        <div class="step">
            <strong>æ–°ã—ã„Google Apps Scriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ:</strong><br>
            1. <a href="https://script.google.com" target="_blank">script.google.com</a> ã§ã€Œæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€<br>
            2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: ã€ŒRentPipe Forms Creator v2ã€<br>
            3. å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã‚’å†åº¦ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ<br>
            4. å†åº¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œ
        </div>
        
        <button class="btn btn-danger" onclick="showAlternativeSteps()">ä»£æ›¿æ‰‹é †ã®è©³ç´°</button>
        <div id="alternative-steps" style="display: none;">
            <div class="error">
                <strong>âš ï¸ æ³¨æ„: æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹å ´åˆ</strong><br>
                1. å¤ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å‰Šé™¤ã—ãªã„ã§ãã ã•ã„<br>
                2. æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å®Œå…¨ã«åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨<br>
                3. ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚‚å®Œå…¨ã«åŒã˜ã«ã™ã‚‹<br>
                4. æ–°ã—ã„URLã‚’RentPipeã«è¨­å®š
            </div>
        </div>
    </div>

    <script>
        // URLå½¢å¼ãƒã‚§ãƒƒã‚¯
        function checkURLFormat() {
            const url = document.getElementById('gas-url-check').value.trim();
            const resultDiv = document.getElementById('url-check-result');
            
            if (!url) {
                resultDiv.className = 'error';
                resultDiv.textContent = 'âŒ URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                return;
            }
            
            const checks = {
                hasHttps: url.startsWith('https://'),
                hasScriptDomain: url.includes('script.google.com'),
                hasMacros: url.includes('/macros/'),
                hasExec: url.endsWith('/exec'),
                hasScriptId: /\/s\/[A-Za-z0-9_-]+\//.test(url)
            };
            
            const allChecksPass = Object.values(checks).every(check => check);
            
            let resultText = '';
            if (allChecksPass) {
                resultDiv.className = 'success';
                resultText = 'âœ… URLå½¢å¼ã¯æ­£ã—ã„ã§ã™ï¼\n\n';
            } else {
                resultDiv.className = 'error';
                resultText = 'âŒ URLå½¢å¼ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ï¼š\n\n';
            }
            
            resultText += `HTTPS: ${checks.hasHttps ? 'âœ…' : 'âŒ'}\n`;
            resultText += `Google Script ãƒ‰ãƒ¡ã‚¤ãƒ³: ${checks.hasScriptDomain ? 'âœ…' : 'âŒ'}\n`;
            resultText += `Macros ãƒ‘ã‚¹: ${checks.hasMacros ? 'âœ…' : 'âŒ'}\n`;
            resultText += `Exec ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: ${checks.hasExec ? 'âœ…' : 'âŒ'}\n`;
            resultText += `Script ID: ${checks.hasScriptId ? 'âœ…' : 'âŒ'}\n`;
            
            if (!allChecksPass) {
                resultText += '\nğŸ’¡ æ­£ã—ã„å½¢å¼: https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
            }
            
            resultDiv.textContent = resultText;
        }
        
        // å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
        function showFullCode() {
            const codeDiv = document.getElementById('complete-code');
            const fullCodeDiv = document.getElementById('full-code');
            
            codeDiv.textContent = `// RentPipe Google Forms Creator - å®Œå…¨ç‰ˆ
function createCustomerForm(customerData) {
  try {
    console.log('ğŸ“ é¡§å®¢å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆé–‹å§‹:', customerData.name);
    
    // ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
    const form = FormApp.create(customerData.name + 'æ§˜å°‚ç”¨ ç‰©ä»¶å¸Œæœ›èª¿æŸ»ãƒ•ã‚©ãƒ¼ãƒ  - RentPipe');
    
    // èª¬æ˜æ–‡è¨­å®š
    form.setDescription(\`ğŸ  RentPipe ç‰©ä»¶å¸Œæœ›èª¿æŸ»ãƒ•ã‚©ãƒ¼ãƒ 

\${customerData.name}æ§˜ã€ã„ã¤ã‚‚ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ã‚ˆã‚Šæœ€é©ãªç‰©ä»¶ã‚’ã”ææ¡ˆã™ã‚‹ãŸã‚ã€è©³ã—ã„ã”å¸Œæœ›æ¡ä»¶ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚

ğŸ“‹ ã“ã®ãƒ•ã‚©ãƒ¼ãƒ ã«ã¤ã„ã¦
- \${customerData.name}æ§˜å°‚ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ ã§ã™
- å›ç­”å†…å®¹ã¯æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã¿ãŒç¢ºèªã§ãã¾ã™
- ä½•åº¦ã§ã‚‚å›ç­”ã‚’ä¿®æ­£ã—ã¦ã„ãŸã ã‘ã¾ã™

ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·
ãŠå®¢æ§˜ã®å€‹äººæƒ…å ±ã¯é©åˆ‡ã«ç®¡ç†ã•ã‚Œã€ç‰©ä»¶ã”ææ¡ˆä»¥å¤–ã®ç›®çš„ã§ã¯ä½¿ç”¨ã„ãŸã—ã¾ã›ã‚“ã€‚\`);
    
    // è³ªå•é …ç›®è¿½åŠ 
    form.addTextItem()
        .setTitle('ã€åŸºæœ¬æƒ…å ±ã€‘ãŠåå‰')
        .setRequired(true);
    
    form.addTextItem()
        .setTitle('ã€åŸºæœ¬æƒ…å ±ã€‘ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹')
        .setRequired(true);
    
    form.addTextItem()
        .setTitle('ã€åŸºæœ¬æƒ…å ±ã€‘é›»è©±ç•ªå·')
        .setRequired(true);
    
    form.addTextItem()
        .setTitle('ã€ä½å±…å¸Œæœ›ã€‘äºˆç®—ï¼ˆä¸‹é™ï¼‰')
        .setHelpText('æœˆé¡å®¶è³ƒã®ä¸‹é™ã‚’ãŠæ•™ãˆãã ã•ã„ï¼ˆä¸‡å††ï¼‰')
        .setRequired(true);
    
    form.addTextItem()
        .setTitle('ã€ä½å±…å¸Œæœ›ã€‘äºˆç®—ï¼ˆä¸Šé™ï¼‰')
        .setHelpText('æœˆé¡å®¶è³ƒã®ä¸Šé™ã‚’ãŠæ•™ãˆãã ã•ã„ï¼ˆä¸‡å††ï¼‰')
        .setRequired(true);
    
    form.addParagraphTextItem()
        .setTitle('ã€ä½å±…å¸Œæœ›ã€‘å¸Œæœ›ã‚¨ãƒªã‚¢')
        .setHelpText('å¸Œæœ›ã™ã‚‹åœ°åŸŸãƒ»é§…åãªã©ã‚’ãŠæ•™ãˆãã ã•ã„ï¼ˆè¤‡æ•°å¯ï¼‰')
        .setRequired(true);
    
    form.addMultipleChoiceItem()
        .setTitle('ã€ä½å±…å¸Œæœ›ã€‘é–“å–ã‚Š')
        .setChoiceValues([
          'ãƒ¯ãƒ³ãƒ«ãƒ¼ãƒ ãƒ»1K',
          '1DKãƒ»1LDK', 
          '2Kãƒ»2DK',
          '2LDKãƒ»3K',
          '3DKãƒ»3LDK',
          '4LDKä»¥ä¸Š',
          'ãã®ä»–ãƒ»ç›¸è«‡'
        ])
        .setRequired(true);
    
    form.addParagraphTextItem()
        .setTitle('ã€è©³ç´°æ¡ä»¶ã€‘ãã®ä»–ã”å¸Œæœ›ãƒ»ã”è³ªå•')
        .setHelpText('é§…å¾’æ­©æ™‚é–“ã€ç¯‰å¹´æ•°ã€ãƒšãƒƒãƒˆã€æ¥½å™¨ã€é§è»Šå ´ã€ã‚ªãƒ¼ãƒˆãƒ­ãƒƒã‚¯ãªã©ã€ãã®ä»–ã®ã”å¸Œæœ›ãŒã‚ã‚Šã¾ã—ãŸã‚‰è‡ªç”±ã«ãŠæ›¸ããã ã•ã„')
        .setRequired(false);
    
    // ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­å®š
    form.setConfirmationMessage('ã”å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚æ‹…å½“è€…ãŒç¢ºèªã®ä¸Šã€æœ€é©ãªç‰©ä»¶ã‚’ã”ææ¡ˆã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚');
    
    // çµæœã‚’è¿”å´
    const result = {
      success: true,
      form: {
        id: form.getId(),
        title: form.getTitle(),
        url: form.getPublishedUrl(),
        editUrl: form.getEditUrl(),
        responsesUrl: \`https://docs.google.com/forms/d/\${form.getId()}/responses\`,
        createdAt: new Date().toISOString()
      }
    };
    
    console.log('âœ… ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆæˆåŠŸ:', result);
    return result;
    
  } catch (error) {
    console.error('âŒ ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
    return {
      success: false,
      error: error.toString()
    };
  }
}

// ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã¨ã—ã¦å…¬é–‹ã™ã‚‹ãŸã‚ã®é–¢æ•°ï¼ˆå¿…é ˆï¼‰
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const result = createCustomerForm(data.customerData);
    
    return ContentService
      .createTextOutput(JSON.stringify(result))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        error: error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// ãƒ†ã‚¹ãƒˆç”¨é–¢æ•°
function testCreateForm() {
  const testCustomer = {
    name: 'ãƒ†ã‚¹ãƒˆå¤ªéƒ',
    email: 'test@example.com',
    phone: '03-0000-0000'
  };
  
  const result = createCustomerForm(testCustomer);
  console.log('ãƒ†ã‚¹ãƒˆçµæœ:', result);
  return result;
}`;
            
            fullCodeDiv.style.display = 'block';
        }
        
        // ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã‚’è¡¨ç¤º
        function showDeploySteps() {
            document.getElementById('deploy-steps').style.display = 'block';
        }
        
        // ä»£æ›¿æ‰‹é †ã‚’è¡¨ç¤º
        function showAlternativeSteps() {
            document.getElementById('alternative-steps').style.display = 'block';
        }
        
        // ä¿®æ­£å¾Œæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testFixedGAS() {
            const gasUrl = document.getElementById('fixed-gas-url').value.trim();
            const resultDiv = document.getElementById('fixed-test-result');
            
            if (!gasUrl) {
                resultDiv.className = 'error';
                resultDiv.textContent = 'âŒ URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                return;
            }
            
            try {
                resultDiv.className = 'step';
                resultDiv.textContent = 'ğŸ”„ ä¿®æ­£å¾Œæ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
                
                const testData = {
                    customerData: {
                        id: 'fixed-test-' + Date.now(),
                        name: 'ä¿®æ­£ãƒ†ã‚¹ãƒˆå¤ªéƒ',
                        email: 'fixed@example.com',
                        phone: '03-2222-2222'
                    }
                };
                
                const response = await fetch(gasUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData),
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error(\`HTTP \${response.status}: \${response.statusText}\`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'success';
                    resultDiv.textContent = \`âœ… ä¿®æ­£å¾Œæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸï¼

ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆå®Œäº†:
- ID: \${result.form.id}
- ã‚¿ã‚¤ãƒˆãƒ«: \${result.form.title}
- URL: \${result.form.url}

ğŸ‰ Google Apps ScriptãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼
ã“ã®URLã‚’RentPipeã®é¡§å®¢ç®¡ç†ãƒšãƒ¼ã‚¸ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚\`;
                    
                    // æˆåŠŸã—ãŸå ´åˆã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç¢ºèª
                    if (confirm('ä½œæˆã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ ã‚’ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ')) {
                        window.open(result.form.url, '_blank');
                    }
                } else {
                    resultDiv.className = 'error';
                    resultDiv.textContent = \`âŒ Google Apps Scriptã‚¨ãƒ©ãƒ¼: \${result.error}\`;
                }
                
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.textContent = \`âŒ ä¿®æ­£å¾Œã‚‚æ¥ç¶šå¤±æ•—: \${error.message}

ã¾ã è§£æ±ºã—ã¦ã„ãªã„å•é¡Œ:
1. URLå½¢å¼ãŒæ­£ã—ããªã„
2. ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šãŒã€Œå…¨å“¡ã€ã«ãªã£ã¦ã„ãªã„
3. æ¨©é™è¨±å¯ãŒå®Œäº†ã—ã¦ã„ãªã„
4. ã‚³ãƒ¼ãƒ‰ã«æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹

ä»£æ›¿æ‰‹é †ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚\`;
            }
        }
        
        console.log('ğŸ”§ Google Apps Scriptè¨­å®šç¢ºèªãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†');
    </script>
</body>
</html>
