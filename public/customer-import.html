<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡§å®¢ã‚¤ãƒ³ãƒãƒ¼ãƒˆ - RentPipe</title>
    <link rel="stylesheet" href="css/main.css">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'rentpipe-primary': '#667eea',
                        'rentpipe-secondary': '#764ba2',
                        'rentpipe-success': '#10b981',
                        'rentpipe-danger': '#ef4444',
                        'rentpipe-warning': '#f59e0b',
                        'rentpipe-info': '#3b82f6'
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="navigation-container"></div>

    <!-- ãŠçŸ¥ã‚‰ã›ãƒãƒŠãƒ¼ã‚¨ãƒªã‚¢ -->
    <div id="notification-banners" style="max-width: 1200px; margin: 0 auto; padding: 16px 20px 0;"></div>

    <div class="container">
        <div class="header-section">
            <h1>ğŸ“¥ é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h1>
            <p class="text-muted">CSV/JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ç™»éŒ²ã§ãã¾ã™</p>
        </div>

        <!-- ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹æ³•é¸æŠ -->
        <div class="card-rentpipe mb-4" style="margin-bottom: 24px;">
            <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ“‹ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå½¢å¼</h2>
            <div class="flex gap-3" style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button class="btn-rentpipe btn-rentpipe-primary active" data-format="csv" onclick="selectFormat('csv')">
                    ğŸ“„ CSVå½¢å¼
                </button>
                <button class="btn-rentpipe" data-format="json" onclick="selectFormat('json')">
                    ğŸ“¦ JSONå½¢å¼
                </button>
            </div>
        </div>

        <!-- CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ -->
        <div id="csv-import" class="import-section">
            <div class="card-rentpipe">
                <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ“„ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>

                <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
                <div class="upload-area" id="csv-upload-area">
                    <input type="file" id="csv-file-input" accept=".csv" style="display: none;" onchange="handleCsvFile(event)">
                    <label for="csv-file-input" class="upload-label">
                        <div class="upload-icon">ğŸ“</div>
                        <p class="upload-text">ã‚¯ãƒªãƒƒã‚¯ã—ã¦CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                        <p class="upload-hint">ã¾ãŸã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                    </label>
                </div>

                <!-- CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹ -->
                <div class="mt-4" style="margin-top: 24px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">ğŸ“ CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h3>
                    <p style="font-size: 14px; color: #6b7280; margin-bottom: 12px;">
                        RentPipeã®å…¨é …ç›®ã«å¯¾å¿œã—ãŸè©³ç´°ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚<br>
                        å¿…é ˆé …ç›®ã¯ã€Œnameï¼ˆãŠåå‰ï¼‰ã€ã¨ã€Œphoneï¼ˆé›»è©±ç•ªå·ï¼‰ã€ã®ã¿ã§ã™ã€‚ãã®ä»–ã¯ç©ºæ¬„ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚
                    </p>
                    <div style="background: #f9fafb; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                        <h4 style="font-size: 14px; margin: 0 0 8px 0; color: #1f2937;">ğŸ“‹ é …ç›®ä¸€è¦§ï¼ˆå…¨60é …ç›®ï¼‰</h4>
                        <div style="font-size: 12px; color: #6b7280; line-height: 1.6; columns: 2; column-gap: 20px;">
                            <div>åŸºæœ¬æƒ…å ±: name*, nameKana, email, phone*, birthday, gender, currentAddress</div>
                            <div>ä½å±…ãƒ»è·æ¥­: currentHousing, numberOfOccupants, occupation, companyName, yearsEmployed, annualIncome, movingReason</div>
                            <div>å¸Œæœ›æ¡ä»¶: budgetMin, budgetMax, moveInDate, areas, layout, roomSize, stationWalk, floor</div>
                            <div>è¨­å‚™æ¡ä»¶: separateBath, separateWashroom, autoLock, indoorWashing, ãªã©å…¨30é …ç›®</div>
                            <div>å¥‘ç´„æƒ…å ±: contractType, contractStartDate, contractEndDate, monthlyRent, ãªã©</div>
                            <div>ãã®ä»–: pipelineStatus, notes, agentMemo</div>
                        </div>
                    </div>
                    <button class="btn-rentpipe btn-rentpipe-primary mt-2" onclick="downloadCsvTemplate()">
                        â¬‡ï¸ è©³ç´°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                </div>
            </div>
        </div>

        <!-- JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ -->
        <div id="json-import" class="import-section" style="display: none;">
            <div class="card-rentpipe">
                <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ“¦ JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>

                <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
                <div class="upload-area" id="json-upload-area">
                    <input type="file" id="json-file-input" accept=".json" style="display: none;" onchange="handleJsonFile(event)">
                    <label for="json-file-input" class="upload-label">
                        <div class="upload-icon">ğŸ“</div>
                        <p class="upload-text">ã‚¯ãƒªãƒƒã‚¯ã—ã¦JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                        <p class="upload-hint">ã¾ãŸã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                    </label>
                </div>

                <!-- JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹ -->
                <div class="mt-4" style="margin-top: 24px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">ğŸ“ JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h3>
                    <p style="font-size: 14px; color: #6b7280; margin-bottom: 12px;">
                        RentPipeã®å…¨é …ç›®ã«å¯¾å¿œã—ãŸè©³ç´°ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚<br>
                        å¿…é ˆé …ç›®ã¯ã€Œnameï¼ˆãŠåå‰ï¼‰ã€ã¨ã€Œphoneï¼ˆé›»è©±ç•ªå·ï¼‰ã€ã®ã¿ã§ã™ã€‚ãã®ä»–ã¯ç©ºæ–‡å­—åˆ—ï¼ˆ""ï¼‰ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚
                    </p>
                    <pre class="code-block">[
  {
    "name": "å±±ç”°å¤ªéƒ",
    "nameKana": "ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦",
    "email": "yamada@example.com",
    "phone": "090-1234-5678",
    "birthday": "1990-01-15",
    "gender": "male",
    "currentAddress": "æ±äº¬éƒ½æ¸‹è°·åŒº1-2-3",
    "budgetMin": "80000",
    "budgetMax": "100000",
    "areas": "æ¸‹è°·é§…ãƒ»è¡¨å‚é“é§… å¾’æ­©10åˆ†ä»¥å†…",
    "layout": "1K|1DK",
    "pipelineStatus": "åˆå›ç›¸è«‡",
    "notes": "äºˆç®—å†…ã§è‰¯ã„ç‰©ä»¶ã‚’æ¢ã—ãŸã„",
    ...ï¼ˆå…¨60é …ç›®ï¼‰
  }
]</pre>
                    <button class="btn-rentpipe btn-rentpipe-primary mt-2" onclick="downloadJsonTemplate()">
                        â¬‡ï¸ è©³ç´°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                </div>
            </div>
        </div>

        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
        <div id="preview-section" class="card-rentpipe" style="display: none; margin-top: 24px;">
            <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ‘ï¸ ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
            <div id="preview-stats" class="mb-3" style="margin-bottom: 16px;"></div>
            <div id="preview-table-container" style="overflow-x: auto;"></div>
            <div class="mt-4" style="margin-top: 24px; display: flex; gap: 12px;">
                <button class="btn-rentpipe btn-rentpipe-success" onclick="executeImport()">
                    âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ
                </button>
                <button class="btn-rentpipe btn-rentpipe-danger" onclick="cancelImport()">
                    âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
            </div>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="result-section" class="card-rentpipe" style="display: none; margin-top: 24px;">
            <div id="result-content"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/notification-manager.js"></script>
    <script src="js/db.js"></script>

    <script>
        let importData = [];
        let currentFormat = 'csv';

        document.addEventListener('DOMContentLoaded', function() {
            loadNavigation();
            NotificationManager.init();
            setupDragAndDrop();
        });

        function selectFormat(format) {
            currentFormat = format;

            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('[data-format]').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-format') === format);
            });

            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('csv-import').style.display = format === 'csv' ? 'block' : 'none';
            document.getElementById('json-import').style.display = format === 'json' ? 'block' : 'none';

            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»çµæœã‚’ã‚¯ãƒªã‚¢
            hidePreview();
            hideResult();
        }

        function setupDragAndDrop() {
            ['csv-upload-area', 'json-upload-area'].forEach(areaId => {
                const area = document.getElementById(areaId);
                if (!area) return;

                area.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    area.classList.add('dragover');
                });

                area.addEventListener('dragleave', () => {
                    area.classList.remove('dragover');
                });

                area.addEventListener('drop', (e) => {
                    e.preventDefault();
                    area.classList.remove('dragover');

                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        if (areaId === 'csv-upload-area' && file.name.endsWith('.csv')) {
                            handleCsvFile({ target: { files: [file] } });
                        } else if (areaId === 'json-upload-area' && file.name.endsWith('.json')) {
                            handleJsonFile({ target: { files: [file] } });
                        }
                    }
                });
            });
        }

        function handleCsvFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    importData = parseCsv(csv);
                    showPreview();
                } catch (error) {
                    alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function handleJsonFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    importData = JSON.parse(e.target.result);
                    if (!Array.isArray(importData)) {
                        throw new Error('JSONé…åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                    }
                    showPreview();
                } catch (error) {
                    alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function parseCsv(csv) {
            const lines = csv.trim().split('\n');
            if (lines.length < 2) {
                throw new Error('CSVãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ã§ã™');
            }

            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                data.push(row);
            }

            return data;
        }

        function showPreview() {
            const previewSection = document.getElementById('preview-section');
            const statsDiv = document.getElementById('preview-stats');
            const tableContainer = document.getElementById('preview-table-container');

            // çµ±è¨ˆæƒ…å ±
            statsDiv.innerHTML = `
                <div class="badge-rentpipe-info">
                    ğŸ“Š ${importData.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ
                </div>
            `;

            // ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
            if (importData.length > 0) {
                const headers = Object.keys(importData[0]);
                let tableHtml = '<table class="preview-table"><thead><tr>';
                headers.forEach(header => {
                    tableHtml += `<th>${header}</th>`;
                });
                tableHtml += '</tr></thead><tbody>';

                importData.slice(0, 10).forEach(row => {
                    tableHtml += '<tr>';
                    headers.forEach(header => {
                        tableHtml += `<td>${row[header] || ''}</td>`;
                    });
                    tableHtml += '</tr>';
                });

                if (importData.length > 10) {
                    tableHtml += `<tr><td colspan="${headers.length}" class="text-muted" style="text-align: center;">... ä»– ${importData.length - 10} ä»¶</td></tr>`;
                }

                tableHtml += '</tbody></table>';
                tableContainer.innerHTML = tableHtml;
            }

            previewSection.style.display = 'block';
            hideResult();
        }

        function hidePreview() {
            document.getElementById('preview-section').style.display = 'none';
        }

        function hideResult() {
            document.getElementById('result-section').style.display = 'none';
        }

        async function executeImport() {
            if (importData.length === 0) {
                alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            const resultSection = document.getElementById('result-section');
            const resultContent = document.getElementById('result-content');

            try {
                // Supabaseæ¥ç¶šãƒã‚§ãƒƒã‚¯
                if (!window.db) {
                    throw new Error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }

                let successCount = 0;
                let errorCount = 0;
                const errors = [];

                // é€²æ—è¡¨ç¤º
                resultContent.innerHTML = `
                    <div class="text-center">
                        <div class="spinner"></div>
                        <p>ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­... (0 / ${importData.length})</p>
                    </div>
                `;
                resultSection.style.display = 'block';

                // 1ä»¶ãšã¤ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                for (let i = 0; i < importData.length; i++) {
                    try {
                        const customer = importData[i];
                        await window.db.addCustomer({
                            name: customer.name || '',
                            email: customer.email || '',
                            phone: customer.phone || '',
                            company: customer.company || '',
                            address: customer.address || '',
                            notes: customer.notes || ''
                        });
                        successCount++;
                    } catch (error) {
                        errorCount++;
                        errors.push(`è¡Œ${i + 1}: ${error.message}`);
                    }

                    // é€²æ—æ›´æ–°
                    resultContent.innerHTML = `
                        <div class="text-center">
                            <div class="spinner"></div>
                            <p>ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­... (${i + 1} / ${importData.length})</p>
                        </div>
                    `;
                }

                // çµæœè¡¨ç¤º
                resultContent.innerHTML = `
                    <h2 style="font-size: 18px; margin-bottom: 16px;">âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†</h2>
                    <div class="mb-3">
                        <div class="badge-rentpipe-success" style="margin-right: 8px;">
                            æˆåŠŸ: ${successCount}ä»¶
                        </div>
                        ${errorCount > 0 ? `<div class="badge-rentpipe-danger">å¤±æ•—: ${errorCount}ä»¶</div>` : ''}
                    </div>
                    ${errorCount > 0 ? `
                        <div class="mt-3">
                            <h3 style="font-size: 16px; margin-bottom: 8px;">âŒ ã‚¨ãƒ©ãƒ¼è©³ç´°</h3>
                            <pre class="code-block" style="max-height: 200px; overflow-y: auto;">${errors.join('\n')}</pre>
                        </div>
                    ` : ''}
                    <div class="mt-4">
                        <a href="customer.html" class="btn-rentpipe btn-rentpipe-primary">
                            ğŸ“‹ é¡§å®¢ä¸€è¦§ã¸æˆ»ã‚‹
                        </a>
                        <button class="btn-rentpipe" onclick="resetImport()" style="margin-left: 8px;">
                            ğŸ”„ æ–°ã—ã„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                        </button>
                    </div>
                `;

                hidePreview();

            } catch (error) {
                resultContent.innerHTML = `
                    <h2 style="font-size: 18px; margin-bottom: 16px;">âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¤±æ•—</h2>
                    <div class="badge-rentpipe-danger">${error.message}</div>
                    <div class="mt-4">
                        <button class="btn-rentpipe btn-rentpipe-primary" onclick="hideResult()">
                            æˆ»ã‚‹
                        </button>
                    </div>
                `;
                resultSection.style.display = 'block';
            }
        }

        function cancelImport() {
            if (confirm('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ')) {
                resetImport();
            }
        }

        function resetImport() {
            importData = [];
            document.getElementById('csv-file-input').value = '';
            document.getElementById('json-file-input').value = '';
            hidePreview();
            hideResult();
        }

        function downloadCsvTemplate() {
            // RentPipe é¡§å®¢æƒ…å ± è©³ç´°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆå…¨60é …ç›®ï¼‰
            const csv = `name,nameKana,email,phone,birthday,gender,currentAddress,currentHousing,numberOfOccupants,occupation,companyName,yearsEmployed,annualIncome,movingReason,budgetMin,budgetMax,moveInDate,areas,layout,roomSize,stationWalk,floor,buildingAge,separateBath,separateWashroom,autoLock,indoorWashing,deliveryBox,elevator,parking,bicycle,bike,internet,petAllowed,instrumentAllowed,sohoAllowed,twoGasStove,noTatami,flooring,contractType,contractStartDate,contractEndDate,contractPeriodMonths,monthlyRent,depositMonths,keyMoneyMonths,otherInitialCost,contractPropertyAddress,pipelineStatus,notes,agentMemo,desiredMoveInDate,applicationDate,followUpDate,additionalFollowUpDate,additionalFollowUpReminder,contractEndDateManual
å±±ç”°å¤ªéƒ,ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦,yamada@example.com,090-1234-5678,1990-01-15,male,æ±äº¬éƒ½æ¸‹è°·åŒº1-2-3,è³ƒè²¸,1,ä¼šç¤¾å“¡,æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«,5,5000000,è»¢å‹¤,80000,100000,2026å¹´4æœˆ,æ¸‹è°·é§…ãƒ»è¡¨å‚é“é§… å¾’æ­©10åˆ†ä»¥å†…,1K|1DK,25,10,2éšä»¥ä¸Š,ç¯‰10å¹´ä»¥å†…,yes,yes,yes,yes,yes,yes,no,no,no,yes,no,no,no,yes,yes,yes,æ–°è¦å¥‘ç´„,2026-04-01,2028-03-31,24,90000,1,1,50000,æ±äº¬éƒ½æ¸‹è°·åŒºã‚µãƒ³ãƒ—ãƒ«ç”º1-2-3,åˆå›ç›¸è«‡,äºˆç®—å†…ã§è‰¯ã„ç‰©ä»¶ã‚’æ¢ã—ãŸã„,ç©æ¥µçš„ã«ç‰©ä»¶ç´¹ä»‹,2026-04-01,,,,,
ä½è—¤èŠ±å­,ã‚µãƒˆã‚¦ãƒãƒŠã‚³,sato@example.com,080-9876-5432,1995-05-20,female,ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚ä¸­åŒº4-5-6,å®Ÿå®¶,2,è‡ªå–¶æ¥­,ä½è—¤ä¸å‹•ç”£,,3000000,çµå©š,60000,80000,2026å¹´5æœˆ,æ¨ªæµœé§…ãƒ»ã¿ãªã¨ã¿ã‚‰ã„é§…,1LDK|2K,30,15,æŒ‡å®šãªã—,æŒ‡å®šãªã—,yes,yes,yes,no,yes,no,no,no,no,yes,yes,no,no,no,no,no,,,,,,,,,ç‰©ä»¶ç´¹ä»‹,ãƒšãƒƒãƒˆå¯ã®ç‰©ä»¶å¸Œæœ›,çŒ«ã‚’é£¼ã£ã¦ã„ã‚‹,2026-05-01,,,,,`;

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'rentpipe_customer_template_detailed.csv';
            link.click();
        }

        function downloadJsonTemplate() {
            const json = JSON.stringify([
                {
                    // åŸºæœ¬æƒ…å ±ï¼ˆå¿…é ˆé …ç›®: name, phoneï¼‰
                    name: 'å±±ç”°å¤ªéƒ',
                    nameKana: 'ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦',
                    email: 'yamada@example.com',
                    phone: '090-1234-5678',
                    birthday: '1990-01-15',
                    gender: 'male',
                    currentAddress: 'æ±äº¬éƒ½æ¸‹è°·åŒº1-2-3',

                    // ä½å±…ãƒ»è·æ¥­æƒ…å ±
                    currentHousing: 'è³ƒè²¸',
                    numberOfOccupants: '1',
                    occupation: 'ä¼šç¤¾å“¡',
                    companyName: 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«',
                    yearsEmployed: '5',
                    annualIncome: '5000000',
                    movingReason: 'è»¢å‹¤',

                    // å¸Œæœ›æ¡ä»¶
                    budgetMin: '80000',
                    budgetMax: '100000',
                    moveInDate: '2026å¹´4æœˆ',
                    areas: 'æ¸‹è°·é§…ãƒ»è¡¨å‚é“é§… å¾’æ­©10åˆ†ä»¥å†…',
                    layout: '1K|1DK',
                    roomSize: '25',
                    stationWalk: '10',
                    floor: '2éšä»¥ä¸Š',
                    buildingAge: 'ç¯‰10å¹´ä»¥å†…',

                    // è¨­å‚™æ¡ä»¶ï¼ˆyes/noï¼‰
                    separateBath: 'yes',
                    separateWashroom: 'yes',
                    autoLock: 'yes',
                    indoorWashing: 'yes',
                    deliveryBox: 'yes',
                    elevator: 'yes',
                    parking: 'no',
                    bicycle: 'no',
                    bike: 'no',
                    internet: 'yes',
                    petAllowed: 'no',
                    instrumentAllowed: 'no',
                    sohoAllowed: 'no',
                    twoGasStove: 'yes',
                    noTatami: 'yes',
                    flooring: 'yes',

                    // å¥‘ç´„æƒ…å ±
                    contractType: 'æ–°è¦å¥‘ç´„',
                    contractStartDate: '2026-04-01',
                    contractEndDate: '2028-03-31',
                    contractPeriodMonths: '24',
                    monthlyRent: '90000',
                    depositMonths: '1',
                    keyMoneyMonths: '1',
                    otherInitialCost: '50000',
                    contractPropertyAddress: 'æ±äº¬éƒ½æ¸‹è°·åŒºã‚µãƒ³ãƒ—ãƒ«ç”º1-2-3',

                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»ãƒ¡ãƒ¢
                    pipelineStatus: 'åˆå›ç›¸è«‡',
                    notes: 'äºˆç®—å†…ã§è‰¯ã„ç‰©ä»¶ã‚’æ¢ã—ãŸã„',
                    agentMemo: 'ç©æ¥µçš„ã«ç‰©ä»¶ç´¹ä»‹',

                    // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—
                    desiredMoveInDate: '2026-04-01',
                    applicationDate: '',
                    followUpDate: '',
                    additionalFollowUpDate: '',
                    additionalFollowUpReminder: '',
                    contractEndDateManual: ''
                },
                {
                    // æœ€å°é™ã®ä¾‹ï¼ˆå¿…é ˆé …ç›®ã®ã¿ï¼‰
                    name: 'ä½è—¤èŠ±å­',
                    nameKana: 'ã‚µãƒˆã‚¦ãƒãƒŠã‚³',
                    email: 'sato@example.com',
                    phone: '080-9876-5432',
                    birthday: '1995-05-20',
                    gender: 'female',
                    currentAddress: 'ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚ä¸­åŒº4-5-6',
                    currentHousing: 'å®Ÿå®¶',
                    numberOfOccupants: '2',
                    occupation: 'è‡ªå–¶æ¥­',
                    companyName: 'ä½è—¤ä¸å‹•ç”£',
                    yearsEmployed: '',
                    annualIncome: '3000000',
                    movingReason: 'çµå©š',
                    budgetMin: '60000',
                    budgetMax: '80000',
                    moveInDate: '2026å¹´5æœˆ',
                    areas: 'æ¨ªæµœé§…ãƒ»ã¿ãªã¨ã¿ã‚‰ã„é§…',
                    layout: '1LDK|2K',
                    roomSize: '30',
                    stationWalk: '15',
                    floor: 'æŒ‡å®šãªã—',
                    buildingAge: 'æŒ‡å®šãªã—',
                    separateBath: 'yes',
                    separateWashroom: 'yes',
                    autoLock: 'yes',
                    indoorWashing: 'no',
                    deliveryBox: 'yes',
                    elevator: 'no',
                    parking: 'no',
                    bicycle: 'no',
                    bike: 'no',
                    internet: 'yes',
                    petAllowed: 'yes',
                    instrumentAllowed: 'no',
                    sohoAllowed: 'no',
                    twoGasStove: 'no',
                    noTatami: 'no',
                    flooring: 'no',
                    contractType: '',
                    contractStartDate: '',
                    contractEndDate: '',
                    contractPeriodMonths: '',
                    monthlyRent: '',
                    depositMonths: '',
                    keyMoneyMonths: '',
                    otherInitialCost: '',
                    contractPropertyAddress: '',
                    pipelineStatus: 'ç‰©ä»¶ç´¹ä»‹',
                    notes: 'ãƒšãƒƒãƒˆå¯ã®ç‰©ä»¶å¸Œæœ›',
                    agentMemo: 'çŒ«ã‚’é£¼ã£ã¦ã„ã‚‹',
                    desiredMoveInDate: '2026-05-01',
                    applicationDate: '',
                    followUpDate: '',
                    additionalFollowUpDate: '',
                    additionalFollowUpReminder: '',
                    contractEndDateManual: ''
                }
            ], null, 2);

            const blob = new Blob([json], { type: 'application/json;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'rentpipe_customer_template_detailed.json';
            link.click();
        }
    </script>

    <style>
        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .upload-label {
            cursor: pointer;
            display: block;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 8px 0;
        }

        .upload-hint {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
        }

        .code-block {
            background: #1f2937;
            color: #f3f4f6;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .preview-table th, .preview-table td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: left;
        }

        .preview-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #1f2937;
        }

        .preview-table tr:hover {
            background: #f9fafb;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .mb-3 {
            margin-bottom: 16px;
        }

        .mb-4 {
            margin-bottom: 24px;
        }

        .mt-2 {
            margin-top: 8px;
        }

        .mt-3 {
            margin-top: 16px;
        }

        .mt-4 {
            margin-top: 24px;
        }

        .text-center {
            text-align: center;
        }
    </style>
</body>
</html>
