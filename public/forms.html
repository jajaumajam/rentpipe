<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç† - RentPipe</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .forms-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .page-header h1 {
            font-size: 28px;
            margin: 0;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            margin: 0 0 20px 0;
            font-size: 20px;
            color: #1e3a8a;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-description {
            color: #6b7280;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹è¡¨ç¤º */
        .form-status {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-status.has-form {
            background: #ecfdf5;
            border: 1px solid #10b981;
        }

        .form-status.no-form {
            background: #fef3c7;
            border: 1px solid #f59e0b;
        }

        .status-icon {
            font-size: 40px;
        }

        .status-info h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }

        .status-info p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }

        /* URLã‚³ãƒ”ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .url-section {
            margin-top: 20px;
        }

        .url-display {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .url-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            background: #f9fafb;
        }

        .copy-btn {
            padding: 12px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #2563eb;
        }

        .copy-btn.copied {
            background: #10b981;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 14px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
        }

        .action-btn.primary {
            background: #3b82f6;
            color: white;
        }

        .action-btn.primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .action-btn.secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .action-btn.secondary:hover {
            background: #e5e7eb;
        }

        .action-btn.success {
            background: #10b981;
            color: white;
        }

        .action-btn.success:hover {
            background: #059669;
        }

        .action-btn.danger {
            background: #ef4444;
            color: white;
        }

        .action-btn.danger:hover {
            background: #dc2626;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* çµ±è¨ˆæƒ…å ± */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #1e3a8a;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }

        /* ãƒ­ã‚°è¡¨ç¤º */
        .log-section {
            margin-top: 20px;
        }

        .log-container {
            background: #1f2937;
            color: #e5e7eb;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid #374151;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            color: #9ca3af;
            margin-right: 10px;
        }

        .log-success {
            color: #10b981;
        }

        .log-error {
            color: #ef4444;
        }

        .log-info {
            color: #3b82f6;
        }

        /* æ³¨æ„æ›¸ã */
        .notice {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .notice h4 {
            margin: 0 0 10px 0;
            color: #92400e;
        }

        .notice ul {
            margin: 0;
            padding-left: 20px;
            color: #78350f;
        }

        .notice li {
            margin-bottom: 5px;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin: 0 0 20px 0;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons {
                flex-direction: column;
            }

            .url-display {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div id="navigation"></div>

    <main class="forms-container">
        <div class="page-header">
            <h1>ğŸ“‹ Google Formsé€£æº</h1>
            <div id="auth-sync-status"></div>
        </div>

        <!-- Googleèªè¨¼ç¢ºèª -->
        <div class="card" id="authCard">
            <h2>ğŸ” Googleèªè¨¼</h2>
            <div id="authStatus">
                <div class="form-status no-form">
                    <span class="status-icon">âš ï¸</span>
                    <div class="status-info">
                        <h3>Googleèªè¨¼ãŒå¿…è¦ã§ã™</h3>
                        <p>ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</p>
                    </div>
                </div>
                <button class="action-btn primary" onclick="signInGoogle()">
                    ğŸ”‘ Googleã§ãƒ­ã‚°ã‚¤ãƒ³
                </button>
            </div>
        </div>

        <!-- ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç† -->
        <div class="card" id="formManagementCard" style="display: none;">
            <h2>ğŸ“ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ </h2>
            <p class="card-description">
                ãŠå®¢æ§˜ãŒã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç­‰ã§å…¥åŠ›ã§ãã‚‹ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚<br>
                å›ç­”ã¯ã€Œå›ç­”ã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã§é¡§å®¢ã¨ã—ã¦ç™»éŒ²ã§ãã¾ã™ã€‚
            </p>

            <!-- ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ -->
            <div id="formStatus" class="form-status no-form">
                <span class="status-icon">ğŸ“‹</span>
                <div class="status-info">
                    <h3>ãƒ•ã‚©ãƒ¼ãƒ æœªä½œæˆ</h3>
                    <p>ã€Œãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã§ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
                </div>
            </div>

            <!-- URLã‚³ãƒ”ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ•ã‚©ãƒ¼ãƒ ä½œæˆå¾Œã«è¡¨ç¤ºï¼‰ -->
            <div id="urlSection" class="url-section" style="display: none;">
                <label><strong>ãƒ•ã‚©ãƒ¼ãƒ URL:</strong></label>
                <div class="url-display">
                    <input type="text" id="formUrl" class="url-input" readonly>
                    <button class="copy-btn" onclick="copyFormUrl()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                </div>
            </div>

            <!-- çµ±è¨ˆæƒ…å ± -->
            <div id="statsSection" class="stats-grid" style="display: none;">
                <div class="stat-item">
                    <div class="stat-value" id="totalResponses">0</div>
                    <div class="stat-label">ç·å›ç­”æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="importedCount">0</div>
                    <div class="stat-label">å–è¾¼æ¸ˆã¿</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="lastFetched">-</div>
                    <div class="stat-label">æœ€çµ‚å–å¾—</div>
                </div>
            </div>

            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="action-buttons">
                <button id="createFormBtn" class="action-btn primary" onclick="createForm()">
                    âœ¨ ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆ
                </button>
                <button id="fetchResponsesBtn" class="action-btn success" onclick="fetchResponses()" style="display: none;">
                    ğŸ“¥ å›ç­”ã‚’å–å¾—
                </button>
                <button id="openFormBtn" class="action-btn secondary" onclick="openForm()" style="display: none;">
                    ğŸ”— ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
                </button>
                <button id="resetFormBtn" class="action-btn danger" onclick="resetForm()" style="display: none;">
                    ğŸ—‘ï¸ ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                </button>
            </div>

            <!-- æ³¨æ„æ›¸ã -->
            <div class="notice">
                <h4>âš ï¸ ã”æ³¨æ„</h4>
                <ul>
                    <li>ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆã™ã‚‹ã¨ã€Googleãƒ‰ãƒ©ã‚¤ãƒ–ã«ãƒ•ã‚©ãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã¾ã™</li>
                    <li>URLã‚’é¡§å®¢ã«å…±æœ‰ã—ã¦ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«å›ç­”ã—ã¦ã‚‚ã‚‰ã£ã¦ãã ã•ã„</li>
                    <li>å›ç­”ã¯è‡ªå‹•ã§ã¯åæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚ã€Œå›ç­”ã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã§å–ã‚Šè¾¼ã‚“ã§ãã ã•ã„</li>
                    <li>åå‰ã¨é€£çµ¡å…ˆï¼ˆãƒ¡ãƒ¼ãƒ«ã‹é›»è©±ï¼‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„å›ç­”ã¯å–ã‚Šè¾¼ã¾ã‚Œã¾ã›ã‚“</li>
                </ul>
            </div>
        </div>

        <!-- ãƒ­ã‚°è¡¨ç¤º -->
        <div class="card" id="logCard" style="display: none;">
            <h2>ğŸ“œ å®Ÿè¡Œãƒ­ã‚°</h2>
            <div class="log-container" id="logContainer">
                <!-- ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
            </div>
        </div>
    </main>

    <!-- ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <h3 id="modalTitle">ç¢ºèª</h3>
            <p id="modalMessage">æœ¬å½“ã«å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ</p>
            <div class="modal-buttons">
                <button class="action-btn secondary" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="action-btn danger" id="modalConfirmBtn" onclick="confirmAction()">å®Ÿè¡Œ</button>
            </div>
        </div>
    </div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/integrated-auth-manager-v2.js"></script>
    <script src="js/google-drive-api-v2.js"></script>
    <script src="js/google-sheets-api.js"></script>
    <script src="js/data-migration.js"></script>
    <script src="js/unified-sheets-manager.js"></script>
    <script src="js/unified-data-manager.js"></script>
    <script src="js/google-forms-api.js"></script>
    <script src="js/app-initializer.js"></script>

    <script>
        console.log('ğŸ“‹ ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é–‹å§‹...');

        let pendingAction = null;

        // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            // AppInitializerã®åˆæœŸåŒ–ã‚’å¾…ã¤
            if (window.AppInitializer && window.AppInitializer.initializationPromise) {
                try {
                    await window.AppInitializer.initializationPromise;
                } catch (e) {
                    console.warn('AppInitializeråˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
                }
            }

            // GoogleFormsManagerã‚’åˆæœŸåŒ–
            if (window.GoogleFormsManager) {
                await GoogleFormsManager.initialize();
            }

            // èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª
            checkAuthStatus();

            // ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ã‚’ç¢ºèª
            updateFormStatus();
        });

        // èªè¨¼çŠ¶æ…‹ç¢ºèª
        function checkAuthStatus() {
            const isGoogleAuth = window.GoogleDriveAPIv2?.isAuthenticated ||
                                 window.IntegratedAuthManager?.accessToken;

            if (isGoogleAuth) {
                document.getElementById('authCard').style.display = 'none';
                document.getElementById('formManagementCard').style.display = 'block';
                document.getElementById('logCard').style.display = 'block';
                addLog('Googleèªè¨¼æ¸ˆã¿', 'success');
            } else {
                document.getElementById('authCard').style.display = 'block';
                document.getElementById('formManagementCard').style.display = 'none';
            }
        }

        // Googleãƒ­ã‚°ã‚¤ãƒ³
        async function signInGoogle() {
            try {
                addLog('Googleèªè¨¼ã‚’é–‹å§‹...', 'info');

                if (window.GoogleDriveAPIv2) {
                    await GoogleDriveAPIv2.initialize();
                    await GoogleDriveAPIv2.signIn();
                }

                checkAuthStatus();
                updateFormStatus();
            } catch (error) {
                console.error('Googleèªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
                addLog('Googleèªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
                alert('Googleèªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°
        function updateFormStatus() {
            const config = window.GoogleFormsManager?.formConfig;

            if (config && config.formId) {
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚ã‚Š
                document.getElementById('formStatus').innerHTML = `
                    <span class="status-icon">âœ…</span>
                    <div class="status-info">
                        <h3>ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆæ¸ˆã¿</h3>
                        <p>ä½œæˆæ—¥: ${new Date(config.createdAt).toLocaleString('ja-JP')}</p>
                    </div>
                `;
                document.getElementById('formStatus').className = 'form-status has-form';

                // URLè¡¨ç¤º
                document.getElementById('urlSection').style.display = 'block';
                document.getElementById('formUrl').value = config.responderUri || '';

                // çµ±è¨ˆè¡¨ç¤º
                document.getElementById('statsSection').style.display = 'grid';
                document.getElementById('importedCount').textContent = (config.fetchedResponseIds || []).length;
                document.getElementById('lastFetched').textContent = config.lastFetchedAt
                    ? new Date(config.lastFetchedAt).toLocaleString('ja-JP')
                    : '-';

                // ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ‡æ›¿
                document.getElementById('createFormBtn').style.display = 'none';
                document.getElementById('fetchResponsesBtn').style.display = 'inline-flex';
                document.getElementById('openFormBtn').style.display = 'inline-flex';
                document.getElementById('resetFormBtn').style.display = 'inline-flex';

            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ ãªã—
                document.getElementById('formStatus').innerHTML = `
                    <span class="status-icon">ğŸ“‹</span>
                    <div class="status-info">
                        <h3>ãƒ•ã‚©ãƒ¼ãƒ æœªä½œæˆ</h3>
                        <p>ã€Œãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã§ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
                    </div>
                `;
                document.getElementById('formStatus').className = 'form-status no-form';

                // éè¡¨ç¤º
                document.getElementById('urlSection').style.display = 'none';
                document.getElementById('statsSection').style.display = 'none';

                // ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ‡æ›¿
                document.getElementById('createFormBtn').style.display = 'inline-flex';
                document.getElementById('fetchResponsesBtn').style.display = 'none';
                document.getElementById('openFormBtn').style.display = 'none';
                document.getElementById('resetFormBtn').style.display = 'none';
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆ
        async function createForm() {
            const btn = document.getElementById('createFormBtn');
            const originalText = btn.innerHTML;

            try {
                btn.disabled = true;
                btn.innerHTML = 'â³ ç”Ÿæˆä¸­...';
                addLog('ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆã‚’é–‹å§‹...', 'info');

                const config = await window.GoogleFormsManager.createForm();

                addLog('ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆå®Œäº†: ' + config.formId, 'success');
                updateFormStatus();
                alert('âœ… ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼\n\nURLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦é¡§å®¢ã«å…±æœ‰ã—ã¦ãã ã•ã„ã€‚');

            } catch (error) {
                console.error('ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                addLog('ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                alert('âŒ ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // å›ç­”å–å¾—
        async function fetchResponses() {
            const btn = document.getElementById('fetchResponsesBtn');
            const originalText = btn.innerHTML;

            try {
                btn.disabled = true;
                btn.innerHTML = 'â³ å–å¾—ä¸­...';
                addLog('ãƒ•ã‚©ãƒ¼ãƒ å›ç­”ã‚’å–å¾—ä¸­...', 'info');

                const result = await window.GoogleFormsManager.importResponses();

                if (result.imported > 0) {
                    addLog(`${result.imported}ä»¶ã®æ–°è¦é¡§å®¢ã‚’ç™»éŒ²ã—ã¾ã—ãŸ`, 'success');
                    alert(`âœ… ${result.imported}ä»¶ã®æ–°è¦é¡§å®¢ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼`);
                } else {
                    addLog('æ–°ç€å›ç­”ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'info');
                    alert('â„¹ï¸ æ–°ç€å›ç­”ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }

                if (result.errors && result.errors.length > 0) {
                    result.errors.forEach(err => addLog(err, 'error'));
                }

                updateFormStatus();

            } catch (error) {
                console.error('å›ç­”å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                addLog('å›ç­”å–å¾—ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                alert('âŒ å›ç­”å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
        function openForm() {
            const url = window.GoogleFormsManager?.getFormUrl();
            if (url) {
                window.open(url, '_blank');
            } else {
                alert('ãƒ•ã‚©ãƒ¼ãƒ URLãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }

        // URLã‚³ãƒ”ãƒ¼
        function copyFormUrl() {
            const input = document.getElementById('formUrl');
            const btn = document.querySelector('.copy-btn');

            input.select();
            document.execCommand('copy');

            btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼æ¸ˆã¿';
            btn.classList.add('copied');

            setTimeout(() => {
                btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼';
                btn.classList.remove('copied');
            }, 2000);

            addLog('URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 'success');
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetForm() {
            pendingAction = 'reset';
            document.getElementById('modalTitle').textContent = 'ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ';
            document.getElementById('modalMessage').textContent =
                'ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆGoogleãƒ‰ãƒ©ã‚¤ãƒ–ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ï¼‰';
            document.getElementById('confirmModal').classList.add('active');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('confirmModal').classList.remove('active');
            pendingAction = null;
        }

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¢ºèª
        function confirmAction() {
            if (pendingAction === 'reset') {
                window.GoogleFormsManager.resetFormConfig();
                addLog('ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'info');
                updateFormStatus();
            }
            closeModal();
        }

        // ãƒ­ã‚°è¿½åŠ 
        function addLog(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const time = new Date().toLocaleTimeString('ja-JP');
            const typeClass = type === 'success' ? 'log-success' :
                              type === 'error' ? 'log-error' : 'log-info';

            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-time">[${time}]</span><span class="${typeClass}">${message}</span>`;

            container.insertBefore(entry, container.firstChild);

            // ãƒ­ã‚°ãŒå¤šããªã£ãŸã‚‰å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
            while (container.children.length > 50) {
                container.removeChild(container.lastChild);
            }
        }

        console.log('âœ… ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ãƒšãƒ¼ã‚¸æº–å‚™å®Œäº†');
    </script>
</body>
</html>
