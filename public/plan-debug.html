<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プラン管理デバッグ - RentPipe</title>
    <link rel="stylesheet" href="css/pricing.css">
</head>
<body>
    <div style="max-width: 600px; margin: 2rem auto; padding: 2rem;">
        <h1>プラン管理デバッグツール</h1>
        
        <div id="currentStatus" style="background: #f0f9ff; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            読み込み中...
        </div>
        
        <h3>プラン変更テスト</h3>
        <button onclick="setPlan('free')" class="plan-button free">フリープランに変更</button>
        <button onclick="setPlan('standard')" class="plan-button paid">スタンダードに変更</button>
        <button onclick="setPlan('pro')" class="plan-button popular">プロプランに変更</button>
        <button onclick="setPlan('premium')" class="plan-button paid">プレミアムに変更</button>
        
        <br><br>
        <button onclick="addTestCustomer()" style="background: #10b981; color: white; padding: 8px 16px; border: none; border-radius: 4px;">
            テスト顧客追加
        </button>
        <button onclick="clearCustomers()" style="background: #ef4444; color: white; padding: 8px 16px; border: none; border-radius: 4px;">
            全顧客削除
        </button>
    </div>
    
    <script src="js/pricing-plans.js"></script>
    <script src="js/plan-manager.js"></script>
    
    <script>
        function updateStatus() {
            if (!window.PlanManager) return;
            
            const stats = window.PlanManager.getUsageStats();
            document.getElementById('currentStatus').innerHTML = `
                <strong>現在のプラン:</strong> ${stats.plan.name} (${stats.plan.price === 0 ? '無料' : stats.plan.price + '円/月'})<br>
                <strong>顧客数:</strong> ${stats.customers.current}/${stats.customers.limit}人 (${stats.customers.percentage.toFixed(1)}%)<br>
                <strong>警告レベル:</strong> ${stats.customers.warningLevel}
            `;
        }
        
        function setPlan(planId) {
            window.PlanManager.setCurrentPlan(planId);
            updateStatus();
            alert(`プランを ${window.RentPipePlans.getPlan(planId).name} に変更しました`);
        }
        
        function addTestCustomer() {
            const customers = JSON.parse(localStorage.getItem('rentpipe_demo_customers') || '[]');
            customers.push({
                id: 'test-' + Date.now(),
                name: 'テスト顧客' + (customers.length + 1),
                email: 'test' + (customers.length + 1) + '@example.com',
                phone: '090-0000-000' + (customers.length + 1),
                pipelineStatus: '初回相談',
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('rentpipe_demo_customers', JSON.stringify(customers));
            updateStatus();
        }
        
        function clearCustomers() {
            localStorage.removeItem('rentpipe_demo_customers');
            updateStatus();
        }
        
        setTimeout(updateStatus, 1000);
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>
