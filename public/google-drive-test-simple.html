<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive API ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .status-box { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border: 1px solid #ccc;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
            background-color: #007bff;
            color: white;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        pre { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 5px; 
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Google Drive API ãƒ†ã‚¹ãƒˆ</h1>
        
        <div id="status-display" class="status-box warning">
            <h3>ğŸ“Š åˆæœŸåŒ–çŠ¶æ³</h3>
            <p>ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†...</p>
        </div>
        
        <div style="margin: 20px 0;">
            <button id="btn-initialize" onclick="initializeAPI()">
                1. APIåˆæœŸåŒ–
            </button>
            
            <button id="btn-login" onclick="requestAccess()" disabled>
                2. Googleèªè¨¼
            </button>
            
            <button id="btn-create-folder" onclick="testCreateFolder()" disabled>
                3. ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆãƒ†ã‚¹ãƒˆ
            </button>
            
            <button onclick="showDebugInfo()">
                ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º
            </button>
        </div>
        
        <div id="debug-info" class="status-box" style="display: none;">
            <h3>ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h3>
            <pre id="debug-content"></pre>
        </div>
        
        <div id="log-output" class="status-box">
            <h3>ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h3>
            <pre id="log-content">æº–å‚™ä¸­...</pre>
        </div>
    </div>

    <script src="js/google-drive-api-simple.js"></script>
    <script>
        let logContent = [];
        
        // ãƒ­ã‚°è¡¨ç¤ºé–¢æ•°
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            logContent.push(logMessage);
            document.getElementById('log-content').textContent = logContent.join('\n');
            console.log(logMessage);
        }
        
        // 1. APIåˆæœŸåŒ–
        async function initializeAPI() {
            addLog('ğŸ”§ APIåˆæœŸåŒ–é–‹å§‹...');
            
            try {
                const success = await window.GoogleDriveAPISimple.initialize();
                
                if (success) {
                    addLog('âœ… APIåˆæœŸåŒ–æˆåŠŸ');
                    updateStatus('APIåˆæœŸåŒ–å®Œäº†', 'success');
                    document.getElementById('btn-login').disabled = false;
                } else {
                    addLog('âŒ APIåˆæœŸåŒ–å¤±æ•—');
                    updateStatus('APIåˆæœŸåŒ–å¤±æ•—', 'error');
                }
                
            } catch (error) {
                addLog(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus(`åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // 2. Googleèªè¨¼
        function requestAccess() {
            addLog('ğŸ”‘ Googleèªè¨¼é–‹å§‹...');
            
            // ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æˆåŠŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
            window.GoogleDriveAPISimple.onTokenReceived = function(token) {
                addLog('âœ… ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æˆåŠŸ');
                updateStatus('Googleèªè¨¼å®Œäº†', 'success');
                document.getElementById('btn-create-folder').disabled = false;
            };
            
            try {
                window.GoogleDriveAPISimple.requestAccessToken();
                addLog('ğŸ”„ èªè¨¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºä¸­...');
                
            } catch (error) {
                addLog(`âŒ èªè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus(`èªè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // 3. ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆãƒ†ã‚¹ãƒˆ
        async function testCreateFolder() {
            const folderName = `RentPipe-Test-${Date.now()}`;
            addLog(`ğŸ“ ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã€Œ${folderName}ã€ä½œæˆé–‹å§‹...`);
            
            try {
                const folder = await window.GoogleDriveAPISimple.createFolder(folderName);
                addLog(`âœ… ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆæˆåŠŸ: ${folder.name} (ID: ${folder.id})`);
                updateStatus('ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆãƒ†ã‚¹ãƒˆæˆåŠŸï¼', 'success');
                
            } catch (error) {
                addLog(`âŒ ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus(`ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆå¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ›´æ–°
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status-display');
            statusDiv.className = `status-box ${type}`;
            statusDiv.innerHTML = `<h3>ğŸ“Š ç¾åœ¨ã®çŠ¶æ³</h3><p>${message}</p>`;
        }
        
        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º
        function showDebugInfo() {
            const debugInfo = window.GoogleDriveAPISimple.getDebugInfo();
            document.getElementById('debug-content').textContent = JSON.stringify(debugInfo, null, 2);
            document.getElementById('debug-info').style.display = 'block';
            addLog('ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ“„ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            addLog('ğŸ‘† ã€Œ1. APIåˆæœŸåŒ–ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„');
        });
    </script>
</body>
</html>
