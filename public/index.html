<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentPipe - 賃貸営業を、流れるように</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .dashboard-container {
            padding: 20px;
            max-width: 1200px;
            margin: 60px auto 0;
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #1e3a8a;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
        }

        .activity-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .activity-item:hover {
            background: #f1f5f9;
        }

        .activity-icon {
            font-size: 24px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .activity-time {
            color: #94a3b8;
            font-size: 12px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-decoration: none;
            color: #1e293b;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .action-btn:hover {
            background: #f1f5f9;
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .welcome-message {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .welcome-message h1 {
            margin-bottom: 10px;
        }

        .welcome-message p {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="welcome-message">
            <h1>おかえりなさい！👋</h1>
            <p id="currentDate">今日も素晴らしい一日になりますように</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">👥</div>
                <div class="stat-value" id="totalCustomers">0</div>
                <div class="stat-label">総顧客数</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">🔄</div>
                <div class="stat-value" id="activeDeals">0</div>
                <div class="stat-label">進行中の商談</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">✅</div>
                <div class="stat-value" id="completedDeals">0</div>
                <div class="stat-label">今月の成約</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">📈</div>
                <div class="stat-value" id="conversionRate">0%</div>
                <div class="stat-label">成約率</div>
            </div>
        </div>

        <div class="quick-actions">
            <a href="customer.html" class="action-btn">
                <span>➕</span>
                <span>新規顧客登録</span>
            </a>
            <a href="pipeline.html" class="action-btn">
                <span>📊</span>
                <span>パイプライン確認</span>
            </a>
            <a href="customer-form.html" class="action-btn">
                <span>📝</span>
                <span>顧客フォーム</span>
            </a>
            <button onclick="exportData()" class="action-btn">
                <span>💾</span>
                <span>データエクスポート</span>
            </button>
        </div>

        <div class="activity-section">
            <div class="activity-header">
                <h2>最近のアクティビティ</h2>
                <button class="btn btn-sm btn-outline" onclick="refreshActivities()">更新</button>
            </div>
            <div class="activity-list" id="activityList">
                <div class="activity-item">
                    <div class="activity-icon">📝</div>
                    <div class="activity-content">
                        <div class="activity-title">データを読み込み中...</div>
                        <div class="activity-time">しばらくお待ちください</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/navigation.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        // 現在の日付を表示
        const currentDate = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        document.getElementById('currentDate').textContent = 
            currentDate.toLocaleDateString('ja-JP', options) + ' - 今日も素晴らしい一日になりますように';

        // ダッシュボードの統計を更新
        function updateDashboardStats() {
            const customers = JSON.parse(localStorage.getItem('rentpipe_demo_customers') || '[]');
            
            // 総顧客数
            document.getElementById('totalCustomers').textContent = customers.length;
            
            // 進行中の商談（初回相談〜契約まで）
            const activeStatuses = ['初回相談', '物件紹介', '内見', '申込', '審査', '契約'];
            const activeDeals = customers.filter(c => activeStatuses.includes(c.pipelineStatus)).length;
            document.getElementById('activeDeals').textContent = activeDeals;
            
            // 今月の成約
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const completedThisMonth = customers.filter(c => {
                if (c.pipelineStatus !== '完了') return false;
                const updatedDate = new Date(c.updatedAt);
                return updatedDate.getMonth() === currentMonth && 
                       updatedDate.getFullYear() === currentYear;
            }).length;
            document.getElementById('completedDeals').textContent = completedThisMonth;
            
            // 成約率
            const completed = customers.filter(c => c.pipelineStatus === '完了').length;
            const rate = customers.length > 0 ? Math.round((completed / customers.length) * 100) : 0;
            document.getElementById('conversionRate').textContent = rate + '%';
        }

        // アクティビティリストを更新
        function updateActivityList() {
            const customers = JSON.parse(localStorage.getItem('rentpipe_demo_customers') || '[]');
            const activities = [];
            
            // 顧客データからアクティビティを生成
            customers.forEach(customer => {
                activities.push({
                    icon: '👤',
                    title: `${customer.name}さん - ${customer.pipelineStatus}`,
                    time: new Date(customer.updatedAt),
                    type: 'customer'
                });
            });
            
            // 時間順にソート（新しい順）
            activities.sort((a, b) => b.time - a.time);
            
            // 最新5件を表示
            const activityList = document.getElementById('activityList');
            const recentActivities = activities.slice(0, 5);
            
            if (recentActivities.length === 0) {
                activityList.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon">💤</div>
                        <div class="activity-content">
                            <div class="activity-title">まだアクティビティがありません</div>
                            <div class="activity-time">新規顧客を登録してみましょう</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            activityList.innerHTML = recentActivities.map(activity => {
                const timeAgo = getTimeAgo(activity.time);
                return `
                    <div class="activity-item">
                        <div class="activity-icon">${activity.icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-time">${timeAgo}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 時間差を計算
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'たった今';
            if (minutes < 60) return `${minutes}分前`;
            if (hours < 24) return `${hours}時間前`;
            if (days < 30) return `${days}日前`;
            return date.toLocaleDateString('ja-JP');
        }

        // アクティビティを更新
        function refreshActivities() {
            updateActivityList();
            updateDashboardStats();
        }

        // データエクスポート
        function exportData() {
            const customers = localStorage.getItem('rentpipe_demo_customers') || '[]';
            const blob = new Blob([customers], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rentpipe_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboardStats();
            updateActivityList();
            
            // デモデータの生成（初回のみ）
            if (!localStorage.getItem('rentpipe_demo_initialized')) {
                generateDemoData();
                localStorage.setItem('rentpipe_demo_initialized', 'true');
                refreshActivities();
            }
        });

        // デモデータ生成
        function generateDemoData() {
            const demoCustomers = [
                {
                    id: 'demo-1',
                    name: '田中 一郎',
                    email: 'tanaka@example.com',
                    phone: '090-1234-5678',
                    pipelineStatus: '物件紹介',
                    preferences: {
                        budgetMin: 8,
                        budgetMax: 12,
                        areas: ['渋谷', '新宿'],
                        roomType: '1LDK'
                    },
                    notes: '3月末までに引っ越し希望',
                    createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    updatedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 'demo-2',
                    name: '佐藤 花子',
                    email: 'sato@example.com',
                    phone: '080-9876-5432',
                    pipelineStatus: '内見',
                    preferences: {
                        budgetMin: 10,
                        budgetMax: 15,
                        areas: ['目黒', '世田谷'],
                        roomType: '2LDK'
                    },
                    notes: 'ペット可物件希望',
                    createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                    updatedAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 'demo-3',
                    name: '鈴木 太郎',
                    email: 'suzuki@example.com',
                    phone: '070-1111-2222',
                    pipelineStatus: '審査',
                    preferences: {
                        budgetMin: 6,
                        budgetMax: 9,
                        areas: ['渋谷'],
                        roomType: '1K'
                    },
                    notes: '駅近希望',
                    createdAt: new Date(Date.now() - 21 * 24 * 60 * 60 * 1000).toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('rentpipe_demo_customers', JSON.stringify(demoCustomers));
        }
    </script>
</body>
</html>
