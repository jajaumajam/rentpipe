<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡§å®¢ç®¡ç†ï¼ˆç°¡æ˜“ç‰ˆï¼‰ - RentPipe</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ğŸ  RentPipe</h1>
            <nav class="nav-container">
                <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
                <a href="customer.html">é¡§å®¢ç®¡ç†</a>
                <a href="customer-minimal.html" class="active">ç°¡æ˜“ç‰ˆ</a>
                <a href="pipeline.html">ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</a>
                <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div class="nav-user-info"></div>
                <button onclick="handleLogout()" class="btn btn-outline nav-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="page-header">
            <h2>ğŸ‘¥ é¡§å®¢ç®¡ç†ï¼ˆç°¡æ˜“ç‰ˆï¼‰</h2>
            <p>ã‚·ãƒ³ãƒ—ãƒ«ãªé¡§å®¢æƒ…å ±ã®è¡¨ç¤º</p>
        </div>

        <!-- èªè¨¼çŠ¶æ…‹è¡¨ç¤º -->
        <div id="auth-status" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: #f3f4f6;"></div>

        <!-- é¡§å®¢ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="customer-data-status" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: #e5f3ff;">
            <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿çŠ¶æ³</h3>
            <p id="data-loading-info">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

        <!-- é¡§å®¢ãƒªã‚¹ãƒˆ -->
        <div id="customer-simple-list" class="customer-grid">
            <!-- é¡§å®¢ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
        </div>
    </main>

    <!-- å¿…è¦æœ€å°é™ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã¿ -->
    <script src="js/simple-reliable-auth.js"></script>
    
    <script>
        // ğŸ”§ customer-minimal.html å°‚ç”¨ã®ã‚·ãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        console.log('ğŸš€ Customer Minimal åˆæœŸåŒ–é–‹å§‹');

        // DOMèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            // èªè¨¼ãƒã‚§ãƒƒã‚¯
            checkPageAccess();
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º
            displayAuthStatus();
            
            // é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            loadCustomerData();
        });

        // èªè¨¼çŠ¶æ…‹è¡¨ç¤º
        function displayAuthStatus() {
            const authDiv = document.getElementById('auth-status');
            const user = getUser();
            
            if (isLoggedIn() && user) {
                authDiv.innerHTML = `
                    <h3 style="color: #059669; margin: 0 0 0.5rem 0;">âœ… ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹</h3>
                    <p style="margin: 0;">ãƒ­ã‚°ã‚¤ãƒ³ä¸­: <strong>${user.displayName || user.email}</strong></p>
                `;
                authDiv.style.background = '#d1fae5';
            } else {
                authDiv.innerHTML = `
                    <h3 style="color: #dc2626; margin: 0 0 0.5rem 0;">âŒ æœªãƒ­ã‚°ã‚¤ãƒ³</h3>
                    <p style="margin: 0;">ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</p>
                `;
                authDiv.style.background = '#fee2e2';
            }
        }

        // é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadCustomerData() {
            console.log('ğŸ“Š é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
            
            const statusDiv = document.getElementById('data-loading-info');
            const customerList = document.getElementById('customer-simple-list');
            
            // è¤‡æ•°ã®ã‚­ãƒ¼ã‹ã‚‰é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
            const possibleKeys = [
                'rentpipe_demo_customers',
                'rentpipe_customers', 
                'customers',
                'rentpipe_unified_customers'
            ];
            
            let customers = [];
            let foundKey = null;
            
            for (const key of possibleKeys) {
                const data = localStorage.getItem(key);
                console.log(`ğŸ” ãƒã‚§ãƒƒã‚¯ä¸­: ${key} = ${data ? 'ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š' : 'ãƒ‡ãƒ¼ã‚¿ãªã—'}`);
                
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        if (Array.isArray(parsed) && parsed.length > 0) {
                            customers = parsed;
                            foundKey = key;
                            console.log(`âœ… ãƒ‡ãƒ¼ã‚¿ç™ºè¦‹: ${key} (${parsed.length}ä»¶)`);
                            break;
                        }
                    } catch (e) {
                        console.warn(`âŒ ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${key}`, e);
                    }
                }
            }
            
            // çŠ¶æ³ã‚’è¡¨ç¤º
            if (customers.length > 0) {
                statusDiv.innerHTML = `
                    âœ… é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ<br>
                    ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: <code>${foundKey}</code><br>
                    ä»¶æ•°: <strong>${customers.length}ä»¶</strong>
                `;
                statusDiv.parentElement.style.background = '#d1fae5';
                
                // é¡§å®¢ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
                displayCustomers(customers);
                
            } else {
                statusDiv.innerHTML = `
                    âŒ é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“<br>
                    <small>ç¢ºèªã—ãŸã‚­ãƒ¼: ${possibleKeys.join(', ')}</small><br>
                    <button onclick="createDemoData()" class="btn btn-primary" style="margin-top: 10px;">ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</button>
                `;
                statusDiv.parentElement.style.background = '#fee2e2';
            }
        }

        // é¡§å®¢ãƒªã‚¹ãƒˆè¡¨ç¤º
        function displayCustomers(customers) {
            const container = document.getElementById('customer-simple-list');
            container.innerHTML = '';
            
            customers.forEach((customer, index) => {
                const customerCard = document.createElement('div');
                customerCard.className = 'customer-card';
                customerCard.innerHTML = `
                    <div class="customer-header">
                        <h3>${customer.name || 'åå‰ãªã—'}</h3>
                        <span class="status-badge status-${(customer.pipelineStatus || customer.status || 'unknown').replace(/\s+/g, '-')}">${customer.pipelineStatus || customer.status || 'æœªè¨­å®š'}</span>
                    </div>
                    <div class="customer-info">
                        <p>ğŸ“ ${customer.phone || 'é›»è©±ç•ªå·ãªã—'}</p>
                        <p>ğŸ“§ ${customer.email || 'ãƒ¡ãƒ¼ãƒ«ãªã—'}</p>
                        <p>ğŸ’° äºˆç®—: ${customer.preferences?.budget || customer.budget || 'æœªè¨­å®š'}</p>
                    </div>
                    <div class="customer-actions">
                        <button onclick="showCustomerDetail(${index})" class="btn btn-outline">è©³ç´°</button>
                    </div>
                `;
                container.appendChild(customerCard);
            });
        }

        // é¡§å®¢è©³ç´°è¡¨ç¤º
        function showCustomerDetail(index) {
            alert('é¡§å®¢è©³ç´°æ©Ÿèƒ½ã¯ customer.html ã§åˆ©ç”¨ã§ãã¾ã™');
        }

        // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ä½œæˆ
        function createDemoData() {
            const demoCustomers = [
                {
                    id: 'demo1',
                    name: 'ç”°ä¸­å¤ªéƒ',
                    phone: '090-1234-5678',
                    email: 'tanaka@example.com',
                    pipelineStatus: 'åˆå›ç›¸è«‡',
                    preferences: { budget: '10-15ä¸‡å††' },
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo2', 
                    name: 'ä½è—¤èŠ±å­',
                    phone: '080-9876-5432',
                    email: 'sato@example.com',
                    pipelineStatus: 'ç‰©ä»¶ç´¹ä»‹',
                    preferences: { budget: '8-12ä¸‡å††' },
                    createdAt: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('rentpipe_demo_customers', JSON.stringify(demoCustomers));
            console.log('âœ… ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ä½œæˆå®Œäº†');
            
            // å†èª­ã¿è¾¼ã¿
            loadCustomerData();
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
        function handleLogout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                logout();
                window.location.href = 'login.html';
            }
        }

        console.log('âœ… Customer Minimal ã‚¹ã‚¯ãƒªãƒ—ãƒˆæº–å‚™å®Œäº†');
    </script>
</body>
</html>
