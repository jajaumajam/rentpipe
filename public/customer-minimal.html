<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>顧客管理（簡易版） - RentPipe</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1>🏠 RentPipe</h1>
            <nav class="nav-container">
                <a href="index.html">ホーム</a>
                <a href="customer.html">顧客管理</a>
                <a href="customer-minimal.html" class="active">簡易版</a>
                <a href="pipeline.html">パイプライン</a>
                <!-- ユーザー情報表示エリア -->
                <div class="nav-user-info"></div>
                <button onclick="handleLogout()" class="btn btn-outline nav-logout">ログアウト</button>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="page-header">
            <h2>👥 顧客管理（簡易版）</h2>
            <p>シンプルな顧客情報の表示</p>
        </div>

        <!-- 認証状態表示 -->
        <div id="auth-status" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: #f3f4f6;"></div>

        <!-- 顧客データ表示エリア -->
        <div id="customer-data-status" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: #e5f3ff;">
            <h3>📊 データ読み込み状況</h3>
            <p id="data-loading-info">データを読み込み中...</p>
        </div>

        <!-- 顧客リスト -->
        <div id="customer-simple-list" class="customer-grid">
            <!-- 顧客カードがここに動的に追加されます -->
        </div>
    </main>

    <!-- 必要最小限のスクリプトのみ -->
    <script src="js/simple-reliable-auth.js"></script>
    
    <script>
        // 🔧 customer-minimal.html 専用のシンプルスクリプト
        console.log('🚀 Customer Minimal 初期化開始');

        // DOM読み込み完了時の処理
        document.addEventListener('DOMContentLoaded', function() {
            // 認証チェック
            checkPageAccess();
            
            // ユーザー情報表示
            displayAuthStatus();
            
            // 顧客データ読み込み
            loadCustomerData();
        });

        // 認証状態表示
        function displayAuthStatus() {
            const authDiv = document.getElementById('auth-status');
            const user = getUser();
            
            if (isLoggedIn() && user) {
                authDiv.innerHTML = `
                    <h3 style="color: #059669; margin: 0 0 0.5rem 0;">✅ ログイン状態</h3>
                    <p style="margin: 0;">ログイン中: <strong>${user.displayName || user.email}</strong></p>
                `;
                authDiv.style.background = '#d1fae5';
            } else {
                authDiv.innerHTML = `
                    <h3 style="color: #dc2626; margin: 0 0 0.5rem 0;">❌ 未ログイン</h3>
                    <p style="margin: 0;">ログインが必要です</p>
                `;
                authDiv.style.background = '#fee2e2';
            }
        }

        // 顧客データ読み込み
        function loadCustomerData() {
            console.log('📊 顧客データ読み込み開始');
            
            const statusDiv = document.getElementById('data-loading-info');
            const customerList = document.getElementById('customer-simple-list');
            
            // 複数のキーから顧客データを検索
            const possibleKeys = [
                'rentpipe_demo_customers',
                'rentpipe_customers', 
                'customers',
                'rentpipe_unified_customers'
            ];
            
            let customers = [];
            let foundKey = null;
            
            for (const key of possibleKeys) {
                const data = localStorage.getItem(key);
                console.log(`🔍 チェック中: ${key} = ${data ? 'データあり' : 'データなし'}`);
                
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        if (Array.isArray(parsed) && parsed.length > 0) {
                            customers = parsed;
                            foundKey = key;
                            console.log(`✅ データ発見: ${key} (${parsed.length}件)`);
                            break;
                        }
                    } catch (e) {
                        console.warn(`❌ パースエラー: ${key}`, e);
                    }
                }
            }
            
            // 状況を表示
            if (customers.length > 0) {
                statusDiv.innerHTML = `
                    ✅ 顧客データを読み込みました<br>
                    データソース: <code>${foundKey}</code><br>
                    件数: <strong>${customers.length}件</strong>
                `;
                statusDiv.parentElement.style.background = '#d1fae5';
                
                // 顧客リストを表示
                displayCustomers(customers);
                
            } else {
                statusDiv.innerHTML = `
                    ❌ 顧客データが見つかりません<br>
                    <small>確認したキー: ${possibleKeys.join(', ')}</small><br>
                    <button onclick="createDemoData()" class="btn btn-primary" style="margin-top: 10px;">デモデータを作成</button>
                `;
                statusDiv.parentElement.style.background = '#fee2e2';
            }
        }

        // 顧客リスト表示
        function displayCustomers(customers) {
            const container = document.getElementById('customer-simple-list');
            container.innerHTML = '';
            
            customers.forEach((customer, index) => {
                const customerCard = document.createElement('div');
                customerCard.className = 'customer-card';
                customerCard.innerHTML = `
                    <div class="customer-header">
                        <h3>${customer.name || '名前なし'}</h3>
                        <span class="status-badge status-${(customer.pipelineStatus || customer.status || 'unknown').replace(/\s+/g, '-')}">${customer.pipelineStatus || customer.status || '未設定'}</span>
                    </div>
                    <div class="customer-info">
                        <p>📞 ${customer.phone || '電話番号なし'}</p>
                        <p>📧 ${customer.email || 'メールなし'}</p>
                        <p>💰 予算: ${customer.preferences?.budget || customer.budget || '未設定'}</p>
                    </div>
                    <div class="customer-actions">
                        <button onclick="showCustomerDetail(${index})" class="btn btn-outline">詳細</button>
                    </div>
                `;
                container.appendChild(customerCard);
            });
        }

        // 顧客詳細表示
        function showCustomerDetail(index) {
            alert('顧客詳細機能は customer.html で利用できます');
        }

        // デモデータ作成
        function createDemoData() {
            const demoCustomers = [
                {
                    id: 'demo1',
                    name: '田中太郎',
                    phone: '090-1234-5678',
                    email: 'tanaka@example.com',
                    pipelineStatus: '初回相談',
                    preferences: { budget: '10-15万円' },
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo2', 
                    name: '佐藤花子',
                    phone: '080-9876-5432',
                    email: 'sato@example.com',
                    pipelineStatus: '物件紹介',
                    preferences: { budget: '8-12万円' },
                    createdAt: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('rentpipe_demo_customers', JSON.stringify(demoCustomers));
            console.log('✅ デモデータ作成完了');
            
            // 再読み込み
            loadCustomerData();
        }

        // ログアウト処理
        function handleLogout() {
            if (confirm('ログアウトしますか？')) {
                logout();
                window.location.href = 'login.html';
            }
        }

        console.log('✅ Customer Minimal スクリプト準備完了');
    </script>
</body>
</html>
