<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="img/logo-icon.svg">
    <title>„ÅäÁü•„Çâ„Åõ‰∏ÄË¶ß - RentPipe</title>
    <link rel="stylesheet" href="css/main.css">
    <!-- Tailwind CSS (local build) -->
    <link rel="stylesheet" href="css/tailwind-output.css">
</head>
<body>
    <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
    <div id="navigation"></div>

    <!-- „ÅäÁü•„Çâ„Åõ„Éê„Éä„Éº„Ç®„É™„Ç¢ -->
    <div id="notification-banners" style="max-width: 1200px; margin: 0 auto; padding: 16px 20px 0;"></div>

    <div class="container">
        <div class="header-section">
            <h1>üì¢ „ÅäÁü•„Çâ„Åõ‰∏ÄË¶ß</h1>
            <p class="text-muted">RentPipe„Åã„Çâ„ÅÆÈáçË¶Å„Å™„ÅäÁü•„Çâ„Åõ„ÇÑÊõ¥Êñ∞ÊÉÖÂ†±„Çí„ÅîÁ¢∫Ë™ç„ÅÑ„Åü„Å†„Åë„Åæ„Åô</p>
        </div>

        <!-- „Éï„Ç£„É´„Çø„Éº„Ç®„É™„Ç¢ -->
        <div class="mb-4" style="margin-bottom: 24px;">
            <div class="flex gap-2" style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="btn-rentpipe btn-rentpipe-primary active" data-filter="all">
                    „Åô„Åπ„Å¶
                </button>
                <button class="btn-rentpipe" data-filter="info">
                    üìò „ÅäÁü•„Çâ„Åõ
                </button>
                <button class="btn-rentpipe" data-filter="success">
                    ‚úÖ „Ç¢„ÉÉ„Éó„Éá„Éº„Éà
                </button>
                <button class="btn-rentpipe" data-filter="warning">
                    ‚ö†Ô∏è „É°„É≥„ÉÜ„Éä„É≥„Çπ
                </button>
                <button class="btn-rentpipe" data-filter="danger">
                    üö® ÈáçË¶Å
                </button>
            </div>
        </div>

        <!-- „ÅäÁü•„Çâ„Åõ„É™„Çπ„Éà -->
        <div id="notifications-list" class="notifications-list">
            <!-- JavaScript „ÅßÂãïÁöÑÁîüÊàê -->
        </div>

        <!-- Á©∫„ÅÆÁä∂ÊÖã -->
        <div id="empty-state" class="empty-state" style="display: none;">
            <p class="text-muted">Ë©≤ÂΩì„Åô„Çã„ÅäÁü•„Çâ„Åõ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/notification-manager.js"></script>

    <script>
        let currentFilter = 'all';

        document.addEventListener('DOMContentLoaded', async function() {
            // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ÂàùÊúüÂåñ
            loadNavigation();

            // ÈÄöÁü•„Éê„Éä„ÉºÂàùÊúüÂåñÔºàSupabase„Åã„ÇâË™≠„ÅøËæº„ÅøÔºâ
            await NotificationManager.init();

            // „ÅäÁü•„Çâ„Åõ‰∏ÄË¶ß„ÅÆÊèèÁîª
            renderNotificationsList();

            // „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
            setupFilterButtons();
        });

        function renderNotificationsList(filter = 'all') {
            const listContainer = document.getElementById('notifications-list');
            const emptyState = document.getElementById('empty-state');

            // „Åô„Åπ„Å¶„ÅÆÈÄöÁü•„ÇíÂèñÂæóÔºà„Éê„Éä„Éº‰ª•Â§ñ„ÇÇÂê´„ÇÄ„ÄÅÁµÇ‰∫ÜÊó•„Éï„Ç£„É´„Çø„Éº„Å™„ÅóÔºâ
            let notifications = NotificationManager.notifications || [];

            // „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®
            if (filter !== 'all') {
                notifications = notifications.filter(n => n.variant === filter);
            }

            // ÂÑ™ÂÖàÂ∫¶„Å®Êó•‰ªò„Åß„ÇΩ„Éº„Éà
            notifications.sort((a, b) => {
                if (a.priority !== b.priority) {
                    return a.priority - b.priority; // Êï∞Â≠ó„ÅåÂ∞è„Åï„ÅÑ„Åª„Å©ÂÑ™ÂÖàÂ∫¶È´ò„ÅÑ
                }
                return new Date(b.startDate || '2026-01-01') - new Date(a.startDate || '2026-01-01');
            });

            if (notifications.length === 0) {
                listContainer.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            // „Ç´„Éº„ÉâÁîüÊàê
            listContainer.innerHTML = notifications.map(notification => {
                const isRead = NotificationManager.getReadStatus(notification.id);
                const isActive = isNotificationActive(notification);
                const variantColors = getVariantColors(notification.variant);

                return `
                    <div class="notification-card ${isRead ? 'read' : 'unread'} ${!isActive ? 'expired' : ''}"
                         data-id="${notification.id}"
                         data-variant="${notification.variant}">
                        <div class="notification-header">
                            <div class="flex items-center gap-2" style="display: flex; align-items: center; gap: 8px;">
                                <span class="badge-rentpipe-${notification.variant}">
                                    ${getVariantIcon(notification.variant)} ${getVariantLabel(notification.variant)}
                                </span>
                                ${!isActive ? '<span class="badge-rentpipe-info" style="background: #94a3b8;">ÊúüÈôêÂàá„Çå</span>' : ''}
                                ${!isRead ? '<span class="badge-rentpipe-danger" style="font-size: 12px;">NEW</span>' : ''}
                            </div>
                            <div class="notification-date">
                                ${formatDate(notification.startDate)}
                            </div>
                        </div>

                        <h3 class="notification-title">${notification.title}</h3>
                        <p class="notification-message">${notification.message}</p>

                        ${notification.actionText && notification.actionUrl ? `
                            <div class="notification-actions">
                                <a href="${notification.actionUrl}"
                                   class="btn-rentpipe btn-rentpipe-${notification.variant}"
                                   target="_blank"
                                   rel="noopener noreferrer">
                                    ${notification.actionText}
                                </a>
                            </div>
                        ` : ''}

                        <div class="notification-footer">
                            <div class="text-muted" style="font-size: 12px;">
                                ${notification.endDate ? `ÊúâÂäπÊúüÈôê: ${formatDate(notification.endDate)}` : 'ÊúüÈôê„Å™„Åó'}
                            </div>
                            ${!isRead ? `
                                <button class="btn-rentpipe btn-rentpipe-primary"
                                        onclick="markAsRead('${notification.id}')"
                                        style="font-size: 12px; padding: 4px 12px;">
                                    Êó¢Ë™≠„Å´„Åô„Çã
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function isNotificationActive(notification) {
            const now = new Date();
            const startDate = notification.startDate ? new Date(notification.startDate) : null;
            const endDate = notification.endDate ? new Date(notification.endDate) : null;

            if (startDate && now < startDate) return false;
            if (endDate && now > endDate) return false;

            return true;
        }

        function getVariantColors(variant) {
            const colors = {
                'info': { bg: '#dbeafe', border: '#5b7fa6', text: '#3d4e6b' },
                'success': { bg: '#d1fae5', border: '#10b981', text: '#065f46' },
                'warning': { bg: '#fed7aa', border: '#f59e0b', text: '#92400e' },
                'danger': { bg: '#fee2e2', border: '#ef4444', text: '#991b1b' }
            };
            return colors[variant] || colors.info;
        }

        function getVariantIcon(variant) {
            const icons = {
                'info': 'üìò',
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'danger': 'üö®'
            };
            return icons[variant] || 'üìò';
        }

        function getVariantLabel(variant) {
            const labels = {
                'info': '„ÅäÁü•„Çâ„Åõ',
                'success': '„Ç¢„ÉÉ„Éó„Éá„Éº„Éà',
                'warning': '„É°„É≥„ÉÜ„Éä„É≥„Çπ',
                'danger': 'ÈáçË¶Å'
            };
            return labels[variant] || '„ÅäÁü•„Çâ„Åõ';
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}Âπ¥${month}Êúà${day}Êó•`;
        }

        function markAsRead(notificationId) {
            NotificationManager.markAsRead(notificationId);
            renderNotificationsList(getCurrentFilter());
        }

        function setupFilterButtons() {
            const filterButtons = document.querySelectorAll('[data-filter]');
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // „Åô„Åπ„Å¶„ÅÆ„Éú„Çø„É≥„Åã„Çâ active „ÇíÂâäÈô§
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    // „ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Éú„Çø„É≥„Å´ active „ÇíËøΩÂä†
                    this.classList.add('active');

                    // „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®
                    const filter = this.getAttribute('data-filter');
                    renderNotificationsList(filter);
                });
            });
        }

        function getCurrentFilter() {
            const activeButton = document.querySelector('[data-filter].active');
            return activeButton ? activeButton.getAttribute('data-filter') : 'all';
        }
    </script>

    <style>
        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .notification-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .notification-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .notification-card.unread {
            border-left: 4px solid #3d4e6b;
            background: #f8f9ff;
        }

        .notification-card.expired {
            opacity: 0.6;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .notification-date {
            font-size: 14px;
            color: #6b7280;
        }

        .notification-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 8px 0;
            color: #1f2937;
        }

        .notification-message {
            font-size: 14px;
            color: #4b5563;
            line-height: 1.6;
            margin: 0 0 16px 0;
        }

        .notification-actions {
            margin: 16px 0;
        }

        .notification-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .btn-rentpipe.active {
            background: linear-gradient(135deg, #3d4e6b 0%, #576078 100%);
            color: white;
        }

        @media (max-width: 768px) {
            .notification-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .notification-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }
    </style>
</body>
</html>
