<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentPipe - ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ãƒ†ã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="logo-icon">ğŸ </span>
                <span class="logo-text">RentPipe</span>
                <span style="margin-left: 10px; font-size: 12px; color: #f97316;">ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†</span>
            </div>
        </div>
    </nav>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
        <div class="container">
            <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="page-header">
                <h1>ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ãƒ†ã‚¹ãƒˆ</h1>
                <p class="page-description">ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆæ©Ÿèƒ½ã®å‹•ä½œç¢ºèª</p>
            </div>

            <!-- ç¾åœ¨ã®ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ± -->
            <div class="card">
                <div class="card-header">
                    <h2>ç¾åœ¨ã®ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±</h2>
                </div>
                <div class="card-body">
                    <div id="currentTenantInfo">
                        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
            </div>

            <!-- ä½¿ç”¨çŠ¶æ³ -->
            <div class="card">
                <div class="card-header">
                    <h2>ä½¿ç”¨çŠ¶æ³</h2>
                </div>
                <div class="card-body">
                    <div id="usageStats">
                        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
            </div>

            <!-- ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ -->
            <div class="card">
                <div class="card-header">
                    <h2>ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½</h2>
                </div>
                <div class="card-body">
                    <div class="action-buttons">
                        <button onclick="testAddCustomer()" class="btn btn-primary">
                            ãƒ†ã‚¹ãƒˆé¡§å®¢è¿½åŠ 
                        </button>
                        <button onclick="testUpgradePlan()" class="btn btn-outline">
                            ãƒ—ãƒ©ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
                        </button>
                        <button onclick="testDataMigration()" class="btn btn-outline">
                            ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ†ã‚¹ãƒˆ
                        </button>
                        <button onclick="resetTenantData()" class="btn btn-outline" style="color: #dc3545;">
                            ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>
                </div>
            </div>

            <!-- ãƒ­ã‚°è¡¨ç¤º -->
            <div class="card">
                <div class="card-header">
                    <h2>å®Ÿè¡Œãƒ­ã‚°</h2>
                    <button onclick="clearLog()" class="btn btn-sm btn-outline">ã‚¯ãƒªã‚¢</button>
                </div>
                <div class="card-body">
                    <div id="logOutput" style="font-family: monospace; font-size: 12px; background: #f5f5f5; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto;">
                        <p>ãƒ­ã‚°å‡ºåŠ›ã‚¨ãƒªã‚¢</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="js/tenant-manager.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/error-handler.js"></script>
    <script>
        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        function addLog(message, type = 'info') {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#333';
            
            logOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        // ãƒ­ã‚°ã‚¯ãƒªã‚¢
        function clearLog() {
            document.getElementById('logOutput').innerHTML = '<p>ãƒ­ã‚°å‡ºåŠ›ã‚¨ãƒªã‚¢</p>';
        }

        // ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±è¡¨ç¤º
        function displayTenantInfo() {
            const tenant = window.TenantManager.currentTenant;
            const tenantInfo = document.getElementById('currentTenantInfo');
            
            if (tenant) {
                tenantInfo.innerHTML = `
                    <table style="width: 100%;">
                        <tr><td><strong>ãƒ†ãƒŠãƒ³ãƒˆID:</strong></td><td>${tenant.id}</td></tr>
                        <tr><td><strong>åå‰:</strong></td><td>${tenant.name}</td></tr>
                        <tr><td><strong>ãƒ¡ãƒ¼ãƒ«:</strong></td><td>${tenant.email}</td></tr>
                        <tr><td><strong>ãƒ—ãƒ©ãƒ³:</strong></td><td>${tenant.plan}</td></tr>
                        <tr><td><strong>ä¼šç¤¾å:</strong></td><td>${tenant.settings.companyName}</td></tr>
                        <tr><td><strong>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå:</strong></td><td>${tenant.settings.agentName}</td></tr>
                        <tr><td><strong>é¡§å®¢æ•°ä¸Šé™:</strong></td><td>${tenant.settings.maxCustomers === -1 ? 'ç„¡åˆ¶é™' : tenant.settings.maxCustomers}</td></tr>
                        <tr><td><strong>ä½œæˆæ—¥:</strong></td><td>${new Date(tenant.createdAt).toLocaleDateString('ja-JP')}</td></tr>
                    </table>
                `;
                addLog('ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ', 'success');
            } else {
                tenantInfo.innerHTML = '<p style="color: #dc3545;">ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“</p>';
                addLog('ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ä½¿ç”¨çŠ¶æ³è¡¨ç¤º
        function displayUsageStats() {
            const stats = window.TenantManager.getUsageStats();
            const usageStats = document.getElementById('usageStats');
            
            if (stats) {
                const usageColor = stats.usagePercentage > 80 ? '#dc3545' : 
                                  stats.usagePercentage > 50 ? '#ffc107' : '#28a745';
                
                usageStats.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>é¡§å®¢æ•°:</strong> ${stats.customersUsed} / ${stats.customersLimit === -1 ? 'ç„¡åˆ¶é™' : stats.customersLimit}
                        <div style="background: #e0e0e0; height: 20px; border-radius: 10px; margin-top: 5px;">
                            <div style="background: ${usageColor}; width: ${stats.customersLimit === -1 ? 0 : stats.usagePercentage}%; height: 100%; border-radius: 10px; transition: width 0.3s;"></div>
                        </div>
                    </div>
                    <table style="width: 100%;">
                        <tr><td><strong>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½:</strong></td><td>${stats.features.export ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âŒ åˆ©ç”¨ä¸å¯'}</td></tr>
                        <tr><td><strong>åˆ†ææ©Ÿèƒ½:</strong></td><td>${stats.features.analytics ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âŒ åˆ©ç”¨ä¸å¯'}</td></tr>
                        <tr><td><strong>ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼:</strong></td><td>${stats.features.teamMembers === -1 ? 'ç„¡åˆ¶é™' : stats.features.teamMembers + 'å'}</td></tr>
                    </table>
                `;
                addLog('ä½¿ç”¨çŠ¶æ³ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
            } else {
                usageStats.innerHTML = '<p style="color: #dc3545;">ä½¿ç”¨çŠ¶æ³ãŒå–å¾—ã§ãã¾ã›ã‚“</p>';
                addLog('ä½¿ç”¨çŠ¶æ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ãƒ†ã‚¹ãƒˆé¡§å®¢è¿½åŠ 
        function testAddCustomer() {
            const testCustomer = {
                name: `ãƒ†ã‚¹ãƒˆé¡§å®¢ ${Date.now()}`,
                email: `test${Date.now()}@example.com`,
                phone: '090-0000-0000',
                pipelineStatus: 'åˆå›ç›¸è«‡'
            };
            
            const result = window.DemoDataManager.addCustomer(testCustomer);
            
            if (result) {
                addLog(`ãƒ†ã‚¹ãƒˆé¡§å®¢ã€Œ${result.name}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸ`, 'success');
                displayUsageStats();
            } else {
                addLog('é¡§å®¢ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆä¸Šé™åˆ°é”ã®å¯èƒ½æ€§ï¼‰', 'error');
            }
        }

        // ãƒ—ãƒ©ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
        function testUpgradePlan() {
            const currentPlan = window.TenantManager.currentTenant.plan;
            const newPlan = currentPlan === 'free' ? 'standard' : 
                          currentPlan === 'standard' ? 'pro' : 'enterprise';
            
            if (window.TenantManager.upgradePlan(newPlan)) {
                addLog(`ãƒ—ãƒ©ãƒ³ã‚’ ${currentPlan} ã‹ã‚‰ ${newPlan} ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`, 'success');
                displayTenantInfo();
                displayUsageStats();
            } else {
                addLog('ãƒ—ãƒ©ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ†ã‚¹ãƒˆ
        function testDataMigration() {
            addLog('ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            if (window.DemoDataManager.migrateToMultiTenant()) {
                addLog('ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                displayUsageStats();
            } else {
                addLog('ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
        function resetTenantData() {
            if (confirm('æœ¬å½“ã«ãƒ†ãƒŠãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                window.TenantManager.resetTenantData();
                addLog('ãƒ†ãƒŠãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
                displayUsageStats();
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            // ãƒ†ãƒŠãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤
            setTimeout(() => {
                displayTenantInfo();
                displayUsageStats();
                addLog('ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'info');
            }, 500);
        });
    </script>
</body>
</html>
