<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡§å®¢ç®¡ç†ï¼ˆç°¡æ˜“ç‰ˆï¼‰ - RentPipe</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼å†™çœŸè¡¨ç¤ºç”¨ã®CSS */
        .user-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e5e7eb;
            background: #f3f4f6;
        }
        
        .user-photo-small {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .user-photo-placeholder {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            font-weight: bold;
        }
        
        .user-photo-placeholder-small {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            font-weight: bold;
        }
        
        .nav-user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 14px;
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ğŸ  RentPipe</h1>
            <nav class="nav-container">
                <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
                <a href="customer.html">é¡§å®¢ç®¡ç†</a>
                <a href="customer-minimal.html" class="active">ç°¡æ˜“ç‰ˆ</a>
                <a href="pipeline.html">ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</a>
                <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div class="nav-user-info" id="nav-user-display"></div>
                <button onclick="handleLogout()" class="btn btn-outline nav-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="page-header">
            <h2>ğŸ‘¥ é¡§å®¢ç®¡ç†ï¼ˆç°¡æ˜“ç‰ˆï¼‰</h2>
            <p>ã‚·ãƒ³ãƒ—ãƒ«ãªé¡§å®¢æƒ…å ±ã®è¡¨ç¤º</p>
        </div>

        <!-- èªè¨¼çŠ¶æ…‹è¡¨ç¤º -->
        <div id="auth-status" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: #f3f4f6;"></div>

        <!-- é¡§å®¢ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="customer-data-status" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: #e5f3ff;">
            <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿çŠ¶æ³</h3>
            <p id="data-loading-info">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

        <!-- é¡§å®¢ãƒªã‚¹ãƒˆ -->
        <div id="customer-simple-list" class="customer-grid">
            <!-- é¡§å®¢ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
        </div>
    </main>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        // ğŸ”§ customer-minimal.html å†™çœŸãƒ†ã‚¹ãƒˆä¿®æ­£ç‰ˆ
        console.log('ğŸš€ Customer Minimal å†™çœŸãƒ†ã‚¹ãƒˆä¿®æ­£ç‰ˆ åˆæœŸåŒ–é–‹å§‹');

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyBvJGdan0lvVSkaAbbSXQkoh6YyPoGyTgM",
            authDomain: "rentpipe-ab04e.firebaseapp.com",
            projectId: "rentpipe-ab04e",
            storageBucket: "rentpipe-ab04e.firebasestorage.app",
            messagingSenderId: "586040985916",
            appId: "1:586040985916:web:3cdb5db072f1a6569fb639"
        };
        firebase.initializeApp(firebaseConfig);

        // å†™çœŸè¡¨ç¤ºãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆä¿®æ­£ç‰ˆï¼‰
        const PhotoUtils = {
            // å†™çœŸçŠ¶æ³ã®è¿½è·¡
            photoStatus: new Map(),
            
            // å®‰å…¨ãªå†™çœŸè¡¨ç¤ºï¼ˆä¿®æ­£ç‰ˆï¼‰
            createSafePhotoElement: function(photoURL, size = 'normal', fallbackText = 'ğŸ‘¤', trackingId = null) {
                console.log('ğŸ–¼ï¸ å†™çœŸè¦ç´ ä½œæˆ:', { photoURL, size, trackingId });
                
                if (!photoURL) {
                    console.log('ğŸ“· å†™çœŸURL ãªã— - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡¨ç¤º');
                    this.photoStatus.set(trackingId || 'default', { status: 'no-url', element: 'placeholder' });
                    return this.createPlaceholder(size, fallbackText);
                }
                
                const img = document.createElement('img');
                const className = size === 'small' ? 'user-photo-small' : 'user-photo';
                img.className = className;
                img.alt = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å†™çœŸ';
                
                // CORSå¯¾å¿œ - referrerPolicy ã‚’è¨­å®š
                img.referrerPolicy = 'no-referrer';
                img.crossOrigin = 'anonymous';
                
                // æˆåŠŸæ™‚ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
                img.onload = () => {
                    console.log('âœ… å†™çœŸèª­ã¿è¾¼ã¿æˆåŠŸ:', photoURL);
                    this.photoStatus.set(trackingId || 'default', { 
                        status: 'loaded', 
                        element: 'image',
                        url: photoURL,
                        timestamp: new Date().toISOString()
                    });
                    
                    // è¡¨ç¤ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
                    this.updatePhotoStatusDisplay(trackingId);
                };
                
                // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
                img.onerror = (error) => {
                    console.warn('ğŸ“· å†™çœŸèª­ã¿è¾¼ã¿å¤±æ•— - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆ:', photoURL);
                    this.photoStatus.set(trackingId || 'default', { 
                        status: 'error', 
                        element: 'placeholder',
                        url: photoURL,
                        error: error.toString(),
                        timestamp: new Date().toISOString()
                    });
                    
                    const placeholder = this.createPlaceholder(size, fallbackText);
                    img.parentNode.replaceChild(placeholder, img);
                    
                    // è¡¨ç¤ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
                    this.updatePhotoStatusDisplay(trackingId);
                };
                
                // èª­ã¿è¾¼ã¿é–‹å§‹ã‚’è¨˜éŒ²
                this.photoStatus.set(trackingId || 'default', { 
                    status: 'loading', 
                    element: 'image',
                    url: photoURL,
                    timestamp: new Date().toISOString()
                });
                
                // å†™çœŸURLã‚’è¨­å®š
                img.src = photoURL;
                
                return img;
            },
            
            // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ä½œæˆ
            createPlaceholder: function(size = 'normal', fallbackText = 'ğŸ‘¤') {
                const div = document.createElement('div');
                const className = size === 'small' ? 'user-photo-placeholder-small' : 'user-photo-placeholder';
                div.className = className;
                div.textContent = fallbackText;
                
                console.log('ğŸ­ ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ä½œæˆ:', { size, fallbackText });
                return div;
            },
            
            // å†™çœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ›´æ–°
            updatePhotoStatusDisplay: function(trackingId) {
                if (!trackingId) return;
                
                const status = this.photoStatus.get(trackingId);
                const displayElement = document.getElementById('photo-status-display');
                
                if (displayElement && status) {
                    let statusText = '';
                    let statusIcon = '';
                    
                    switch (status.status) {
                        case 'loaded':
                            statusText = 'âœ… æ­£å¸¸è¡¨ç¤º';
                            statusIcon = 'âœ…';
                            break;
                        case 'error':
                            statusText = 'ğŸ”„ ä»£æ›¿è¡¨ç¤ºï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰';
                            statusIcon = 'ğŸ”„';
                            break;
                        case 'loading':
                            statusText = 'â³ èª­ã¿è¾¼ã¿ä¸­';
                            statusIcon = 'â³';
                            break;
                        case 'no-url':
                            statusText = 'ğŸ­ ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆå†™çœŸURLãªã—ï¼‰';
                            statusIcon = 'ğŸ­';
                            break;
                        default:
                            statusText = 'â“ ä¸æ˜';
                            statusIcon = 'â“';
                    }
                    
                    displayElement.innerHTML = `å†™çœŸè¡¨ç¤º: ${statusText}`;
                }
            },
            
            // å†™çœŸçŠ¶æ³ã®è©³ç´°å–å¾—
            getPhotoStatusDetails: function(trackingId) {
                return this.photoStatus.get(trackingId || 'default');
            },
            
            // å†™çœŸURLã®ãƒ†ã‚¹ãƒˆï¼ˆæ”¹å–„ç‰ˆ - å®Ÿéš›ã®è¡¨ç¤ºçµæœã‚’ä½¿ç”¨ï¼‰
            getPhotoDisplayStatus: function(trackingId) {
                const status = this.photoStatus.get(trackingId || 'default');
                if (!status) {
                    return { working: false, reason: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æœªè¨˜éŒ²' };
                }
                
                switch (status.status) {
                    case 'loaded':
                        return { working: true, reason: 'æ­£å¸¸ã«èª­ã¿è¾¼ã¿ãƒ»è¡¨ç¤ºæ¸ˆã¿' };
                    case 'error':
                        return { working: false, reason: 'èª­ã¿è¾¼ã¿å¤±æ•—ï¼ˆä»£æ›¿è¡¨ç¤ºä¸­ï¼‰' };
                    case 'loading':
                        return { working: null, reason: 'èª­ã¿è¾¼ã¿ä¸­' };
                    case 'no-url':
                        return { working: false, reason: 'å†™çœŸURLãŒæä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“' };
                    default:
                        return { working: false, reason: 'ä¸æ˜ãªçŠ¶æ…‹' };
                }
            }
        };

        // çµ±åˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
        const IntegratedAuth = {
            // è¤‡æ•°ã®èªè¨¼æ–¹å¼ã‹ã‚‰çµ±ä¸€ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
            getAuthenticatedUser: function() {
                console.log('ğŸ” çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯é–‹å§‹...');
                
                // æ–¹æ³•1: simple-reliable-authæ–¹å¼
                const authSimple = localStorage.getItem('rentpipe_auth_simple');
                const userSimple = localStorage.getItem('rentpipe_user_simple');
                
                if (authSimple === 'logged_in' && userSimple) {
                    try {
                        const user = JSON.parse(userSimple);
                        console.log('âœ… simple-reliable-authæ–¹å¼ã§èªè¨¼ç¢ºèª:', user.email);
                        console.log('ğŸ–¼ï¸ å†™çœŸURLç¢ºèª:', user.photoURL);
                        return { method: 'simple-reliable-auth', user: user };
                    } catch (e) {
                        console.warn('simple-reliable-auth ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', e);
                    }
                }
                
                // æ–¹æ³•2: Googleèªè¨¼ãƒ•ãƒ©ã‚°æ–¹å¼
                const tempAuth = localStorage.getItem('rentpipe_temp_auth');
                const userInfo = localStorage.getItem('rentpipe_user_info');
                
                if (tempAuth === 'google_authenticated' && userInfo) {
                    try {
                        const user = JSON.parse(userInfo);
                        console.log('âœ… Googleèªè¨¼ãƒ•ãƒ©ã‚°æ–¹å¼ã§èªè¨¼ç¢ºèª:', user.email);
                        console.log('ğŸ–¼ï¸ å†™çœŸURLç¢ºèª:', user.photoURL);
                        
                        // èªè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’ simple-reliable-auth å½¢å¼ã«çµ±ä¸€
                        this.unifyAuthData(user);
                        
                        return { method: 'google-auth-flag', user: user };
                    } catch (e) {
                        console.warn('Googleèªè¨¼ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', e);
                    }
                }
                
                // æ–¹æ³•3: Firebaseèªè¨¼ï¼ˆéåŒæœŸï¼‰
                return new Promise((resolve) => {
                    firebase.auth().onAuthStateChanged((user) => {
                        if (user) {
                            console.log('âœ… Firebaseèªè¨¼ã§èªè¨¼ç¢ºèª:', user.email);
                            console.log('ğŸ–¼ï¸ Firebaseå†™çœŸURL:', user.photoURL);
                            
                            const userData = {
                                uid: user.uid,
                                email: user.email,
                                displayName: user.displayName,
                                photoURL: user.photoURL
                            };
                            
                            // èªè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’çµ±ä¸€
                            this.unifyAuthData(userData);
                            
                            resolve({ method: 'firebase-auth', user: userData });
                        } else {
                            console.log('âŒ å…¨ã¦ã®èªè¨¼æ–¹å¼ã§æœªèªè¨¼');
                            resolve(null);
                        }
                    });
                });
            },
            
            // èªè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›
            unifyAuthData: function(user) {
                console.log('ğŸ”§ èªè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›:', user.email);
                
                // simple-reliable-auth å½¢å¼ã§ä¿å­˜
                localStorage.setItem('rentpipe_auth_simple', 'logged_in');
                localStorage.setItem('rentpipe_user_simple', JSON.stringify(user));
                
                // Googleèªè¨¼ãƒ•ãƒ©ã‚°ã‚‚ä¿å­˜ï¼ˆäº’æ›æ€§ï¼‰
                localStorage.setItem('rentpipe_temp_auth', 'google_authenticated');
                localStorage.setItem('rentpipe_user_info', JSON.stringify(user));
                
                console.log('âœ… èªè¨¼ãƒ‡ãƒ¼ã‚¿çµ±ä¸€å®Œäº†');
            },
            
            // èªè¨¼çŠ¶æ…‹ç¢ºèªï¼ˆåŒæœŸãƒ»éåŒæœŸä¸¡å¯¾å¿œï¼‰
            isAuthenticated: function() {
                const syncResult = this.getAuthenticatedUser();
                
                if (syncResult && typeof syncResult === 'object' && !syncResult.then) {
                    // åŒæœŸçš„ã«èªè¨¼ç¢ºèªæ¸ˆã¿
                    return true;
                } else if (syncResult && syncResult.then) {
                    // éåŒæœŸï¼ˆFirebaseèªè¨¼ï¼‰
                    return syncResult.then(result => !!result);
                } else {
                    // æœªèªè¨¼
                    return false;
                }
            }
        };

        // DOMèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ“„ DOMèª­ã¿è¾¼ã¿å®Œäº†');
            
            // çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯
            await performIntegratedAuthCheck();
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º
            await displayAuthStatus();
            
            // é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            loadCustomerData();
        });

        // çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯
        async function performIntegratedAuthCheck() {
            console.log('ğŸ” çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ');
            
            try {
                const authResult = IntegratedAuth.getAuthenticatedUser();
                
                if (authResult && authResult.then) {
                    // éåŒæœŸï¼ˆFirebaseèªè¨¼ï¼‰
                    const result = await authResult;
                    if (!result) {
                        console.log('ğŸ”’ æœªèªè¨¼ - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ');
                        window.location.href = 'login-google-simple.html';
                        return;
                    }
                    window.currentUser = result.user;
                    console.log('âœ… Firebaseèªè¨¼çµŒç”±ã§èªè¨¼ç¢ºèª:', result.user.email);
                    
                } else if (authResult) {
                    // åŒæœŸçš„ã«èªè¨¼ç¢ºèªæ¸ˆã¿
                    window.currentUser = authResult.user;
                    console.log('âœ… åŒæœŸèªè¨¼ã§èªè¨¼ç¢ºèª:', authResult.user.email);
                    
                } else {
                    // æœªèªè¨¼
                    console.log('ğŸ”’ çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯çµæœ: æœªèªè¨¼');
                    window.location.href = 'login-google-simple.html';
                    return;
                }
                
            } catch (error) {
                console.error('âŒ çµ±åˆèªè¨¼ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', error);
                window.location.href = 'login-google-simple.html';
            }
        }

        // èªè¨¼çŠ¶æ…‹è¡¨ç¤ºï¼ˆä¿®æ­£ç‰ˆï¼‰
        async function displayAuthStatus() {
            const authDiv = document.getElementById('auth-status');
            
            if (window.currentUser) {
                console.log('ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤ºé–‹å§‹:', window.currentUser);
                console.log('ğŸ–¼ï¸ å†™çœŸURL:', window.currentUser.photoURL);
                
                // å†™çœŸè¦ç´ ä½œæˆï¼ˆè¿½è·¡IDä»˜ãï¼‰
                const trackingId = 'main-user-photo';
                const photoElement = PhotoUtils.createSafePhotoElement(
                    window.currentUser.photoURL,
                    'normal',
                    window.currentUser.displayName ? window.currentUser.displayName.charAt(0) : 'ğŸ‘¤',
                    trackingId
                );
                
                // èªè¨¼çŠ¶æ…‹è¡¨ç¤ºï¼ˆä¿®æ­£ç‰ˆï¼‰
                authDiv.innerHTML = `
                    <h3 style="color: #059669; margin: 0 0 0.5rem 0;">âœ… èªè¨¼çŠ¶æ…‹: ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿</h3>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="user-photo-container"></div>
                        <div>
                            <div style="font-weight: bold;">${window.currentUser.displayName || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'}</div>
                            <div style="font-size: 0.9rem; color: #6b7280;">${window.currentUser.email}</div>
                            <div style="font-size: 0.8rem; color: #9ca3af;" id="photo-status-display">å†™çœŸ: èª­ã¿è¾¼ã¿ä¸­...</div>
                        </div>
                    </div>
                `;
                authDiv.style.background = '#d1fae5';
                
                // å†™çœŸè¦ç´ ã‚’è¿½åŠ 
                document.getElementById('user-photo-container').appendChild(photoElement);
                
                // å†™çœŸèª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã£ã¦æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆä¿®æ­£ç‰ˆï¼‰
                setTimeout(() => {
                    const photoStatus = PhotoUtils.getPhotoDisplayStatus(trackingId);
                    const statusDisplay = document.getElementById('photo-status-display');
                    
                    if (statusDisplay) {
                        if (photoStatus.working === true) {
                            statusDisplay.innerHTML = 'å†™çœŸ: âœ… æ­£å¸¸è¡¨ç¤º';
                            statusDisplay.style.color = '#059669';
                        } else if (photoStatus.working === false) {
                            statusDisplay.innerHTML = 'å†™çœŸ: ğŸ­ ä»£æ›¿è¡¨ç¤º';
                            statusDisplay.style.color = '#f59e0b';
                        } else {
                            statusDisplay.innerHTML = 'å†™çœŸ: â³ èª­ã¿è¾¼ã¿ä¸­';
                            statusDisplay.style.color = '#6b7280';
                        }
                    }
                    
                    console.log('ğŸ“¸ æœ€çµ‚å†™çœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', photoStatus);
                }, 2000);
                
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º
                updateNavigation();
                
            } else {
                authDiv.innerHTML = `
                    <h3 style="color: #dc2626; margin: 0 0 0.5rem 0;">âŒ èªè¨¼çŠ¶æ…‹: æœªãƒ­ã‚°ã‚¤ãƒ³</h3>
                    <p style="margin: 0;">ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</p>
                    <button onclick="window.location.href='login-google-simple.html'" style="margin-top: 10px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Googleãƒ­ã‚°ã‚¤ãƒ³
                    </button>
                `;
                authDiv.style.background = '#fee2e2';
            }
        }

        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°ï¼ˆä¿®æ­£ç‰ˆï¼‰
        function updateNavigation() {
            if (!window.currentUser) return;
            
            const navUserInfo = document.getElementById('nav-user-display');
            if (navUserInfo && !navUserInfo.hasChildNodes()) {
                console.log('ğŸ¨ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å†™çœŸè¡¨ç¤º:', window.currentUser.photoURL);
                
                // å°ã•ã„å†™çœŸè¦ç´ ä½œæˆï¼ˆè¿½è·¡IDä»˜ãï¼‰
                const smallPhotoElement = PhotoUtils.createSafePhotoElement(
                    window.currentUser.photoURL,
                    'small',
                    window.currentUser.displayName ? window.currentUser.displayName.charAt(0) : 'ğŸ‘¤',
                    'nav-user-photo'
                );
                
                // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ä½œæˆ
                const textSpan = document.createElement('span');
                textSpan.textContent = window.currentUser.displayName || window.currentUser.email.split('@')[0];
                
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
                navUserInfo.appendChild(smallPhotoElement);
                navUserInfo.appendChild(textSpan);
            }
        }

        // é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆå¤‰æ›´ãªã—ï¼‰
        function loadCustomerData() {
            console.log('ğŸ“Š é¡§å®¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
            
            const statusDiv = document.getElementById('data-loading-info');
            const customerList = document.getElementById('customer-simple-list');
            
            // è¤‡æ•°ã®ã‚­ãƒ¼ã‹ã‚‰é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
            const possibleKeys = [
                'rentpipe_demo_customers',
                'rentpipe_customers', 
                'customers',
                'rentpipe_unified_customers'
            ];
            
            let customers = [];
            let foundKey = null;
            
            for (const key of possibleKeys) {
                const data = localStorage.getItem(key);
                console.log(`ğŸ” ãƒã‚§ãƒƒã‚¯ä¸­: ${key} = ${data ? 'ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š' : 'ãƒ‡ãƒ¼ã‚¿ãªã—'}`);
                
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        if (Array.isArray(parsed) && parsed.length > 0) {
                            customers = parsed;
                            foundKey = key;
                            console.log(`âœ… ãƒ‡ãƒ¼ã‚¿ç™ºè¦‹: ${key} (${parsed.length}ä»¶)`);
                            break;
                        }
                    } catch (e) {
                        console.warn(`âŒ ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${key}`, e);
                    }
                }
            }
            
            // çŠ¶æ³ã‚’è¡¨ç¤º
            if (customers.length > 0) {
                statusDiv.innerHTML = `
                    âœ… é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ<br>
                    ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: <code>${foundKey}</code><br>
                    ä»¶æ•°: <strong>${customers.length}ä»¶</strong>
                `;
                statusDiv.parentElement.style.background = '#d1fae5';
                
                // é¡§å®¢ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
                displayCustomers(customers);
                
            } else {
                statusDiv.innerHTML = `
                    âŒ é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“<br>
                    <small>ç¢ºèªã—ãŸã‚­ãƒ¼: ${possibleKeys.join(', ')}</small><br>
                    <button onclick="createDemoData()" class="btn btn-primary" style="margin-top: 10px;">ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</button>
                `;
                statusDiv.parentElement.style.background = '#fee2e2';
            }
        }

        // é¡§å®¢ãƒªã‚¹ãƒˆè¡¨ç¤º
        function displayCustomers(customers) {
            const container = document.getElementById('customer-simple-list');
            container.innerHTML = '';
            
            customers.forEach((customer, index) => {
                const customerCard = document.createElement('div');
                customerCard.className = 'customer-card';
                customerCard.innerHTML = `
                    <div class="customer-header">
                        <h3>${customer.name || 'åå‰ãªã—'}</h3>
                        <span class="status-badge status-${(customer.pipelineStatus || customer.status || 'unknown').replace(/\s+/g, '-')}">${customer.pipelineStatus || customer.status || 'æœªè¨­å®š'}</span>
                    </div>
                    <div class="customer-info">
                        <p>ğŸ“ ${customer.phone || 'é›»è©±ç•ªå·ãªã—'}</p>
                        <p>ğŸ“§ ${customer.email || 'ãƒ¡ãƒ¼ãƒ«ãªã—'}</p>
                        <p>ğŸ’° äºˆç®—: ${customer.preferences?.budget || customer.budget || 'æœªè¨­å®š'}</p>
                    </div>
                    <div class="customer-actions">
                        <button onclick="showCustomerDetail('${customer.id}')" class="btn btn-outline">è©³ç´°</button>
                    </div>
                `;
                container.appendChild(customerCard);
            });
        }

        // é¡§å®¢è©³ç´°è¡¨ç¤º
        function showCustomerDetail(customerId) {
            if (customerId) {
                window.location.href = `customer-detail.html?id=${customerId}`;
            } else {
                alert('é¡§å®¢IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }

        // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ä½œæˆ
        function createDemoData() {
            const demoCustomers = [
                {
                    id: 'demo1',
                    name: 'ç”°ä¸­å¤ªéƒ',
                    phone: '090-1234-5678',
                    email: 'tanaka@example.com',
                    pipelineStatus: 'åˆå›ç›¸è«‡',
                    preferences: { budget: '10-15ä¸‡å††' },
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo2', 
                    name: 'ä½è—¤èŠ±å­',
                    phone: '080-9876-5432',
                    email: 'sato@example.com',
                    pipelineStatus: 'ç‰©ä»¶ç´¹ä»‹',
                    preferences: { budget: '8-12ä¸‡å††' },
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo3',
                    name: 'éˆ´æœ¨ä¸€éƒ',
                    phone: '070-1111-2222',
                    email: 'suzuki@example.com',
                    pipelineStatus: 'å†…è¦‹',
                    preferences: { budget: '12-18ä¸‡å††' },
                    createdAt: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('rentpipe_demo_customers', JSON.stringify(demoCustomers));
            console.log('âœ… ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ä½œæˆå®Œäº†');
            
            // å†èª­ã¿è¾¼ã¿
            loadCustomerData();
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
        function handleLogout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                // å…¨ã¦ã®èªè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                const authKeys = [
                    'rentpipe_auth_simple',
                    'rentpipe_user_simple',
                    'rentpipe_temp_auth',
                    'rentpipe_user_info',
                    'rentpipe_auth'
                ];
                
                authKeys.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                // Firebaseèªè¨¼ã‚‚ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ
                firebase.auth().signOut();
                
                console.log('ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå®Œäº†');
                window.location.href = 'login-google-simple.html';
            }
        }

        console.log('âœ… Customer Minimal å†™çœŸãƒ†ã‚¹ãƒˆä¿®æ­£ç‰ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆæº–å‚™å®Œäº†');
    </script>
</body>
</html>
