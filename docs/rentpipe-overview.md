# RentPipe 全機能概要ドキュメント

> このドキュメントは、RentPipe の全機能・技術構成・ビジネスモデルを網羅した資料です。
> マーケティング・集客戦略・機能改善の検討などにご活用ください。

---

## 目次

1. [サービス概要](#1-サービス概要)
2. [ターゲットユーザー](#2-ターゲットユーザー)
3. [技術構成](#3-技術構成)
4. [各画面の機能詳細](#4-各画面の機能詳細)
5. [主要機能モジュール](#5-主要機能モジュール)
6. [料金プラン](#6-料金プラン)
7. [データ管理の仕組み](#7-データ管理の仕組み)
8. [顧客データ構造](#8-顧客データ構造)
9. [設計上の特徴・差別化ポイント](#9-設計上の特徴差別化ポイント)

---

## 1. サービス概要

**RentPipe** は、賃貸仲介エージェント個人向けに特化した CRM（顧客管理）ツールです。

### キャッチコピー
「また相談したいエージェントになる」

### 現在のステータス
- v1.0.0-beta（ベータ版）
- ベータ期間中は全機能を無料開放中
- Vercel にホスティング

---

## 2. ターゲットユーザー

**メインターゲット：** 不動産会社に所属する個人の賃貸仲介エージェント

### ターゲットの特徴
- 自分の担当顧客（いわゆる「顧客ノート」）を個人で管理したい
- 成約後の長期フォローアップで、顧客からの紹介・リピートを狙いたい
- 個人の営業活動を効率化したい

### 提供価値
- 顧客情報の一元管理（検索・フィルタ・ステージ管理）
- 成約後の自動フォローアップ（Google カレンダー連携）
- 物件問い合わせフォームの自動生成（Google フォーム連携）
- メッセージテンプレートで連絡業務を効率化

---

## 3. 技術構成

| レイヤー | 使用技術 |
|---|---|
| フロントエンド | Vanilla JavaScript (ES6+)、HTML5、Tailwind CSS |
| 認証 | Google OAuth 2.0（Google Identity Services） |
| 顧客データ | ブラウザ LocalStorage（主）＋ Google Drive/Sheets（バックアップ・同期） |
| Google 連携 | Drive v3、Sheets v4、Calendar v3、Forms v1 |
| バックエンド | Vercel サーバーレス関数（Node.js） |
| データベース | Supabase（PostgreSQL）— プラン・ユーザー管理のみ |
| 決済 | Stripe（ベータ中は無効化） |
| ホスティング | Vercel |

### 取得している Google OAuth スコープ
- `drive.file`（Drive ファイル作成・読み取り）
- `spreadsheets`（Sheets フルアクセス）
- `userinfo.email` / `userinfo.profile`
- `forms.body` / `forms.responses.readonly`
- `calendar`

---

## 4. 各画面の機能詳細

### 4-1. ログイン画面（`login.html`）

- 左カラム：サービスの特徴紹介
- 右カラム：「Google でログイン」ボタン
- Google OAuth 認証後、顧客管理画面へリダイレクト
- 自動ログアウト理由（タイムアウト・トークン期限切れ・手動）をメッセージ表示

---

### 4-2. 顧客管理画面（`customer.html`）— メイン画面

#### 統計カード（4種類）
- 進行中件数
- 成約済み件数
- 失注件数
- 今月の新規件数

※設定画面でカード表示の ON/OFF が可能

#### 検索・フィルタ
- フリーテキスト検索（氏名・メール・電話番号 / 300ms デバウンス）
- タブフィルタ：進行中 / 成約済み / 失注 / 全件
- パイプラインステージ別フィルタボタン（動的生成）

#### 顧客一覧テーブル
| カラム | 内容 |
|---|---|
| 氏名 | クリックで編集画面へ |
| 連絡先 | 電話番号・メールアドレス |
| 予算 | 下限〜上限（万円） |
| 希望エリア | テキスト |
| ステータス | カラーバッジ（ステージ別色分け） |
| 登録日 | 日付 |
| アクション | 編集 / アーカイブ or 復元 |

#### アーカイブ機能
- 失注処理（メモ付き）
- アーカイブ済み顧客の復元（ステージ選択）

---

### 4-3. 顧客情報登録・編集画面（`customer-form.html`）

**2モード：** 新規登録 / 編集（URL パラメータ `?edit={id}` で切り替え）

アコーディオン形式の折りたたみセクション構成：

#### セクション1：基本情報
氏名、氏名カナ、メールアドレス、電話番号、生年月日、性別、現住所、現在の住居タイプ、職業、勤務先、勤続年数、年収（万円）、引越し理由、入居人数

#### セクション2：希望条件
- 予算：下限・上限（万円単位ドロップダウン）
- 入居希望時期
- 希望エリア（テキスト）
- 間取り：1R / 1K / 1DK / 1LDK / 2K / 2DK / 2LDK / 3K〜（チェックボックス）
- 部屋の広さ（㎡ スライダー）
- 駅徒歩分数（スライダー）
- 築年数（こだわりなし / X年以内）
- 階数希望（スライダー）

#### セクション3：設備条件
チェックボックス15項目以上（カテゴリ別）

| カテゴリ | 項目例 |
|---|---|
| セキュリティ | オートロック、バス・トイレ別、洗面台独立、室内洗濯機置き場、2口以上コンロ |
| 内装・共用設備 | フローリング、和室なし、エレベーター、宅配ボックス、インターネット無料 |
| 駐車・特殊 | 駐車場、バイク置き場、自転車置き場、ペット可、楽器可、SOHO 可 |

#### セクション4：追加情報
自由記述ノート

#### セクション5：エージェントメモ
エージェントのみ参照できるメモ（顧客には非表示）

#### セクション6：管理者セクション
パイプラインステージ選択

#### セクション7：契約セクション
- 契約日、契約タイプ（普通借家 / 定期借家）、契約期間（ヶ月）、契約終了日
- 物件住所、月額家賃、入居日
- **フォローアップカレンダー登録トグル**：
  ON にすると Google カレンダーにフォローアップイベントを自動作成

---

### 4-4. パイプライン管理画面（`pipeline.html`）

**6列カンバンボード**（横スクロール対応）

| ステージ | カラー |
|---|---|
| 初回相談 | ブルー |
| 物件紹介 | パープル |
| 内見調整 | シアン |
| 申込準備 | アンバー |
| 審査中 | オレンジ |
| 契約手続き | グリーン |

#### 顧客カード
- 氏名、メール、電話番号、予算範囲
- 「ステータス変更」ボタン → モーダルで移動先ステージを選択

アーカイブ（失注）済み顧客は非表示。他タブ・他ウィンドウとリアルタイム同期。

---

### 4-5. フォーム画面（`forms.html`）

**Google フォーム連携による問い合わせ受付**

#### フォーム未作成状態
- 「フォーム詳細設定」を開いて生成するよう案内

#### フォーム作成済み状態
- フォーム URL（コピーボタン付き）
- QR コード表示（200×200）
- 取り込み済み回答数・最終取得日時
- 「新しい回答を取り込む」ボタン

#### フォーム詳細設定アコーディオン
- ステータス表示（作成済み / 未作成）
- 「フォームを生成」ボタン：ユーザーの Google Drive に 26 問構成の Google フォームを自動生成
- 「フォームを削除して再生成」ボタン
- **プライバシーポリシー設定：**
  - 担当者名・会社名
  - 第三者提供先企業（動的追加・削除）
  - カスタムプライバシーポリシー URL
  - 自動生成された個人情報取り扱い説明文のプレビュー（フォームの冒頭に挿入される）

#### 回答の取り込み処理
- 新着回答を自動マッピングして顧客として登録
- 氏名・電話番号のない回答はスキップ
- 取り込み済み回答の重複防止（ID 管理）

---

### 4-6. テンプレート画面（`templates.html`）

#### 担当者情報設定
- 担当者名・メールアドレス・電話番号を保存（テンプレート変数として使用）

#### 顧客セレクター
- アクティブな顧客一覧から選択 → `{お客様名}` 等の変数を自動置換

#### カテゴリタブ
- すべて / 商談進行中 / 成約後フォロー

#### 組み込みテンプレート（16種類）

**商談進行中（9種類）：**
1. 初回連絡のお礼
2. 物件紹介
3. 内見日程確認
4. 内見前日リマインダー
5. 内見後フォローアップ
6. 申込手続きご案内
7. 審査状況のご連絡
8. 審査通過のご連絡
9. 契約日程のご連絡

**成約後フォロー（7種類）：**
10. ご入居後のご挨拶
11. 1ヶ月後フォロー
12. 6ヶ月後フォロー
13. 1年後フォロー
14. ご紹介のお願い
15. お引越しのご相談

#### テンプレート操作
- コピー（クリップボード）
- 編集・保存（カスタマイズした内容を Google Sheets に保存）
- デフォルトに戻す

#### 使用できる変数
| 変数 | 内容 |
|---|---|
| `{お客様名}` | 選択した顧客の氏名 |
| `{担当者名}` | 設定した担当者名 |
| `{担当者メールアドレス}` | 設定したメールアドレス |
| `{担当者電話番号}` | 設定した電話番号 |

#### カレンダーからのディープリンク
Google カレンダーのフォローアップイベントの説明文に、該当テンプレートへの直リンクが記載される
（例：`templates.html?templateId=one-month-followup&customerId=xxx`）

---

### 4-7. 設定画面（`settings.html`）

#### アカウント
- ログイン中の Google アカウントメールアドレス
- Drive・Sheets 同期ステータス確認

#### プラン管理
- 現在のプラン表示
- ベータ中は「全機能無料開放中！」バナー
- プラン比較表（Free / Senior Agent）
- アップグレード → Stripe チェックアウト
- 有料会員向け：Stripe カスタマーポータル（解約・請求管理）

#### 表示設定
- 統計カード表示の ON/OFF トグル

---

### 4-8. データ管理画面（`data.html`）

- 顧客数・アクティブ顧客数・最終同期時刻の表示
- 「データを同期」ボタン（Google Sheets から強制再取得）
- 一括インポート画面へのリンク
- **デンジャーゾーン：** ローカルデータをクリア（Google Sheets のデータは消えない）

---

### 4-9. 一括インポート画面（`customer-import.html`）

- CSV / JSON 形式対応
- CSV：ドラッグ＆ドロップまたはクリックでアップロード
- 60 フィールドのテンプレート CSV ダウンロード機能
- フィールド説明ガイド（折りたたみ表示）
- 必須フィールドは `name`（氏名）と `phone`（電話番号）のみ

---

### 4-10. その他の画面

| 画面 | 内容 |
|---|---|
| `notifications.html` | お知らせ一覧（Info / Update / Maintenance / Critical タブ） |
| `help.html` | FAQ ページ |
| `about.html` | サービス紹介ページ |
| `privacy.html` | プライバシーポリシー |
| `terms.html` | 利用規約 |
| `tokushoho.html` | 特定商取引法に基づく表記 |
| `admin.html` | 管理者用お知らせ投稿パネル（内部ツール） |

---

## 5. 主要機能モジュール

### Google カレンダー自動フォローアップ

顧客の契約情報（入居日・契約タイプ）を入力後、フォローアップカレンダーを ON にすると以下のイベントが Google カレンダーに自動作成される：

| タイミング | イベント名 |
|---|---|
| 入居日翌日 | お礼・ご挨拶 |
| 1ヶ月後 | 1ヶ月後フォロー |
| 6ヶ月後 | 6ヶ月後フォロー |
| 1年後 | 1年後フォロー |
| 契約終了日（定期借家の場合） | 更新・再契約のご相談 |

各イベントの説明文には顧客情報と該当テンプレートへの直リンクが含まれる。

### セッション管理
- 24 時間無操作でセッションタイムアウト
- Google トークン期限切れの自動検知・ログアウト

### データ同期の仕組み
1. **書き込み時：** LocalStorage に即時保存 → Google Sheets へ非同期同期
2. **起動時：** Sheets からデータを取得してローカルとマージ（Sheets 側が新しい場合は Sheets が優先）
3. **「設定」データ：** テンプレートカスタマイズ・フォーム設定・担当者情報は Sheets の「Settings」シートに JSON で保存

---

## 6. 料金プラン

| プラン | 料金 | 対象機能 |
|---|---|---|
| **Free** | ¥0 | 顧客管理、パイプライン管理、データ管理 |
| **Senior Agent** | ¥2,480/月 | Free の全機能 ＋ Google フォーム連携、テンプレート管理、カレンダー連携、フォローアップ自動化 |

> ベータ期間中は全ユーザーが Senior Agent 相当の全機能を無料で利用可能。

---

## 7. データ管理の仕組み

### ゼロナレッジ設計（最大の差別化ポイント）

**顧客の個人情報は RentPipe のサーバーに一切保存されない。**

| データ種別 | 保存場所 |
|---|---|
| 顧客個人情報（氏名・電話・収入等） | ブラウザ LocalStorage ＋ ユーザー自身の Google Drive/Sheets |
| ユーザーID・メール・プラン情報 | Supabase（RentPipe サーバー） |
| テンプレートカスタマイズ・フォーム設定 | ユーザー自身の Google Sheets（Settings シート） |

### 主要 localStorage キー

| キー | 内容 |
|---|---|
| `rentpipe_customers` | 全顧客データの JSON 配列 |
| `rentpipe_auth` | ログイン状態（userId, email, name） |
| `google_auth_data` | Google OAuth 状態（アクセストークン等） |
| `rentpipe_ui_settings` | UI 設定（統計カード表示等） |
| `rentpipe_template_settings` | 担当者情報 |
| `rentpipe_custom_templates` | カスタマイズ済みテンプレート |
| `rentpipe_google_form` | Google フォーム設定（formId 等） |
| `rentpipe_privacy_settings` | プライバシーポリシー設定 |

---

## 8. 顧客データ構造

1件の顧客データには 60 以上のフィールドが含まれる：

```
{
  id: UUID,
  basicInfo: {
    name, nameKana, email, phone, birthday, gender,
    currentAddress, currentHousing, occupation, companyName,
    yearsEmployed, annualIncome, movingReason, numberOfOccupants
  },
  preferences: {
    budget: { min, max },
    moveInDate, areas, layout[], roomSize,
    stationWalk, buildingAge, floor
  },
  equipment: {
    autoLock, separateBath, separateWashroom, indoorWashing,
    twoStoveBurners, flooring, noTatami, elevator,
    packageLocker, freeInternet, parking, bikeParking,
    bicycleParking, petsAllowed, instrumentsAllowed, sohoAllowed
  },
  additionalInfo: { notes },
  agentMemo: string,
  contractInfo: {
    contractDate, contractType,    // 普通借家 or 定期借家
    contractPeriodMonths, contractEndDate,
    propertyAddress, monthlyRent, moveInDate
  },
  followUpSettings: {
    enabled, calendarEventsCreated, calendarEventIds[]
  },
  pipelineStatus: "初回相談" | "物件紹介" | "内見調整" | "申込準備" | "審査中" | "契約手続き",
  isActive: boolean,
  archivedAt: ISO date,
  archiveReason: "成約" | "失注" | "その他",
  createdAt, updatedAt: ISO date
}
```

---

## 9. 設計上の特徴・差別化ポイント

### 1. 個人情報をサーバーに持たないゼロナレッジ設計
ユーザーのデータはすべて自分の Google Drive/Sheets とブラウザローカルに保存。プライバシーリスクを最小化。

### 2. Google エコシステムとの深い統合
- **Google Sheets：** データバックアップ・端末間同期
- **Google フォーム：** 問い合わせ受付フォームを自動生成（26問）
- **Google カレンダー：** 成約後フォローアップを自動スケジューリング
- **Google Drive：** 設定データの保存

### 3. 成約後フォローアップの自動化
カレンダーイベントからテンプレートへの直リンクにより、「いつ」「誰に」「何を送るか」がワンクリックで完結。紹介・リピート獲得を仕組み化。

### 4. 完全ゼロコードでの導入
エージェント本人がインストール作業なしに利用開始できる Web アプリ。Supabase・Google API のキーはすべてバックエンドで管理。

### 5. フィーチャーフラグによる段階的解放
`BETA_MODE = true` で全機能解放中。`false` に切り替えると Free プランの機能制限が即座に有効化される設計。Free ユーザーへのアップグレード動線も実装済み。

### 6. イベント駆動型リアルタイム更新
`rentpipe-data-updated` カスタムイベントにより、データ更新時に全画面が即時再描画。他タブ・他ウィンドウとの同期にも対応。

---

*最終更新：2026年2月*
